<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Travel English Circus</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700;800&family=Noto+Sans+JP:wght@300;400;500;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
/* ===== CSS Variables / Design System ===== */
:root {
  --main: #1B4F72;
  --main-dark: #154360;
  --main-light: #2E86C1;
  --sub-light: #AED6F1;
  --sub-mint: #A3E4D7;
  --accent: #F39C12;
  --accent-orange: #E67E22;
  --accent-red: #E74C3C;
  --success: #27AE60;
  --bg-start: #F0F8FF;
  --bg-end: #E8F4FD;
  --white: #FFFFFF;
  --gray-50: #F8FAFC;
  --gray-100: #F1F5F9;
  --gray-200: #E2E8F0;
  --gray-300: #CBD5E1;
  --gray-400: #94A3B8;
  --gray-500: #64748B;
  --gray-600: #475569;
  --gray-700: #334155;
  --gray-800: #1E293B;
  --text: #2C3E50;
  --text-light: #5D6D7E;
  --radius-sm: 8px;
  --radius-md: 12px;
  --radius-lg: 16px;
  --radius-xl: 24px;
  --shadow-sm: 0 1px 3px rgba(0,0,0,0.08);
  --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
  --shadow-lg: 0 8px 24px rgba(0,0,0,0.12);
  --shadow-xl: 0 12px 36px rgba(0,0,0,0.15);
  --font-display: 'Baloo 2', cursive;
  --font-body: 'Noto Sans JP', 'Inter', sans-serif;
  --font-phrase: 'Inter', 'Noto Sans JP', sans-serif;
  --transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* ===== Reset & Base ===== */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; -webkit-tap-highlight-color: transparent; }
body {
  font-family: var(--font-body);
  color: var(--text);
  background: linear-gradient(135deg, var(--bg-start) 0%, var(--bg-end) 100%);
  min-height: 100vh;
  line-height: 1.6;
  overflow-x: hidden;
}

/* ===== Background Decoration ===== */
body::before {
  content: '';
  position: fixed;
  top: -50%;
  right: -30%;
  width: 80vw;
  height: 80vw;
  background: radial-gradient(circle, rgba(174,214,241,0.15) 0%, transparent 70%);
  pointer-events: none;
  z-index: 0;
}
body::after {
  content: '';
  position: fixed;
  bottom: -40%;
  left: -20%;
  width: 60vw;
  height: 60vw;
  background: radial-gradient(circle, rgba(163,228,215,0.1) 0%, transparent 70%);
  pointer-events: none;
  z-index: 0;
}

/* ===== Header ===== */
.header {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 1000;
  background: rgba(255,255,255,0.92);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border-bottom: 1px solid rgba(27,79,114,0.08);
  box-shadow: var(--shadow-sm);
}
.header-inner {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 16px;
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.logo {
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  text-decoration: none;
  color: var(--main);
}
.logo-icon { font-size: 28px; }
.logo-text {
  font-family: var(--font-display);
  font-size: 1.3rem;
  font-weight: 800;
  color: var(--main);
  letter-spacing: -0.5px;
}
.logo-text span { color: var(--accent); }

/* Hamburger */
.hamburger {
  display: flex;
  flex-direction: column;
  gap: 5px;
  cursor: pointer;
  padding: 8px;
  background: none;
  border: none;
  z-index: 1002;
}
.hamburger span {
  display: block;
  width: 24px;
  height: 2.5px;
  background: var(--main);
  border-radius: 2px;
  transition: var(--transition);
}
.hamburger.active span:nth-child(1) { transform: rotate(45deg) translate(5px, 5px); }
.hamburger.active span:nth-child(2) { opacity: 0; }
.hamburger.active span:nth-child(3) { transform: rotate(-45deg) translate(5px, -5px); }

/* ===== Side Navigation ===== */
.nav-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.4);
  z-index: 1000;
  opacity: 0;
  visibility: hidden;
  transition: var(--transition);
}
.nav-overlay.active { opacity: 1; visibility: visible; }

.side-nav {
  position: fixed;
  top: 0;
  right: -320px;
  width: 300px;
  max-width: 85vw;
  height: 100vh;
  background: var(--white);
  z-index: 1001;
  transition: right 0.35s cubic-bezier(0.4, 0, 0.2, 1);
  overflow-y: auto;
  padding: 80px 20px 40px;
  box-shadow: var(--shadow-xl);
}
.side-nav.active { right: 0; }

.nav-section-title {
  font-family: var(--font-display);
  font-size: 0.75rem;
  color: var(--gray-400);
  text-transform: uppercase;
  letter-spacing: 1px;
  padding: 16px 12px 8px;
}
.nav-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px;
  border-radius: var(--radius-md);
  cursor: pointer;
  transition: var(--transition);
  text-decoration: none;
  color: var(--text);
  font-size: 0.95rem;
  font-weight: 500;
}
.nav-item:hover, .nav-item.active { background: rgba(27,79,114,0.06); color: var(--main); }
.nav-item .nav-icon { font-size: 1.3rem; width: 32px; text-align: center; }
.nav-divider { height: 1px; background: var(--gray-200); margin: 8px 12px; }

/* ===== Main Content ===== */
.main { padding-top: 60px; position: relative; z-index: 1; min-height: 100vh; }
.page { display: none; padding: 24px 16px 80px; max-width: 900px; margin: 0 auto; animation: fadeIn 0.4s ease; }
.page.active { display: block; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }

/* ===== Home Page ===== */
.hero {
  text-align: center;
  padding: 40px 0 32px;
}
.hero-title {
  font-family: var(--font-display);
  font-size: 2rem;
  color: var(--main);
  font-weight: 800;
  line-height: 1.3;
  margin-bottom: 8px;
}
.hero-title span { color: var(--accent); }
.hero-subtitle {
  color: var(--text-light);
  font-size: 0.95rem;
  margin-bottom: 24px;
}

/* Pal Welcome */
.pal-welcome {
  display: flex;
  align-items: flex-start;
  gap: 16px;
  background: var(--white);
  border-radius: var(--radius-lg);
  padding: 20px;
  margin-bottom: 32px;
  box-shadow: var(--shadow-md);
  border-left: 4px solid var(--accent);
}
.pal-message {
  flex: 1;
  font-size: 0.95rem;
  line-height: 1.7;
  color: var(--text);
}
.pal-message strong { color: var(--main); }

/* Progress Summary */
.progress-summary {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
  margin-bottom: 32px;
}
.progress-card {
  background: var(--white);
  border-radius: var(--radius-md);
  padding: 16px;
  text-align: center;
  box-shadow: var(--shadow-sm);
}
.progress-num {
  font-family: var(--font-display);
  font-size: 1.8rem;
  font-weight: 800;
  color: var(--main);
}
.progress-label {
  font-size: 0.75rem;
  color: var(--text-light);
  margin-top: 2px;
}

/* Section Cards */
.section-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
}
.section-card {
  background: var(--white);
  border-radius: var(--radius-lg);
  padding: 20px 16px;
  text-align: center;
  cursor: pointer;
  transition: var(--transition);
  box-shadow: var(--shadow-sm);
  border: 2px solid transparent;
  text-decoration: none;
  color: var(--text);
}
.section-card:hover { transform: translateY(-3px); box-shadow: var(--shadow-lg); border-color: var(--sub-light); }
.section-card .card-icon { font-size: 2rem; margin-bottom: 8px; display: block; }
.section-card .card-title { font-family: var(--font-display); font-size: 0.95rem; font-weight: 700; color: var(--main); }
.section-card .card-desc { font-size: 0.75rem; color: var(--text-light); margin-top: 4px; }

/* ===== Pal SVG ===== */
.pal-container { display: inline-block; position: relative; }
.pal-svg { width: 64px; height: 64px; }
.pal-mini { width: 40px; height: 40px; }
.pal-large { width: 100px; height: 100px; }

/* ===== Scene Page Common ===== */
.page-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 24px;
  padding-bottom: 16px;
  border-bottom: 2px solid var(--gray-100);
}
.page-header-icon { font-size: 2rem; }
.page-header-title { font-family: var(--font-display); font-size: 1.5rem; font-weight: 800; color: var(--main); }

/* Mode Tabs */
.mode-tabs {
  display: flex;
  gap: 8px;
  margin-bottom: 20px;
  flex-wrap: wrap;
}
.mode-tab {
  padding: 8px 18px;
  border-radius: 999px;
  font-size: 0.85rem;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  background: var(--gray-100);
  color: var(--gray-600);
  border: none;
  font-family: var(--font-body);
}
.mode-tab.active { background: var(--main); color: var(--white); }

/* Politeness Toggle */
.politeness-toggle {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 16px;
  font-size: 0.85rem;
  color: var(--text-light);
}
.toggle-switch {
  position: relative;
  width: 48px;
  height: 26px;
  background: var(--sub-light);
  border-radius: 999px;
  cursor: pointer;
  transition: var(--transition);
}
.toggle-switch.polite { background: var(--main-light); }
.toggle-switch::after {
  content: '';
  position: absolute;
  top: 3px;
  left: 3px;
  width: 20px;
  height: 20px;
  background: var(--white);
  border-radius: 50%;
  transition: var(--transition);
  box-shadow: var(--shadow-sm);
}
.toggle-switch.polite::after { left: 25px; }

/* Phrase Card */
.phrase-card {
  background: var(--white);
  border-radius: var(--radius-md);
  padding: 16px;
  margin-bottom: 10px;
  box-shadow: var(--shadow-sm);
  border-left: 4px solid var(--sub-light);
  transition: var(--transition);
  position: relative;
}
.phrase-card:hover { box-shadow: var(--shadow-md); }
.phrase-jp { font-size: 0.85rem; color: var(--text-light); margin-bottom: 6px; }
.phrase-en { font-family: var(--font-phrase); font-size: 1.1rem; font-weight: 600; color: var(--main-dark); line-height: 1.5; }
.phrase-note { font-size: 0.75rem; color: var(--gray-400); margin-top: 4px; font-style: italic; }

/* Favorite Button */
.fav-btn {
  position: absolute;
  top: 12px;
  right: 12px;
  background: none;
  border: none;
  font-size: 1.2rem;
  cursor: pointer;
  color: var(--gray-300);
  transition: var(--transition);
  padding: 4px;
}
.fav-btn.active { color: var(--accent); }
.fav-btn:hover { transform: scale(1.2); }

/* Sparkle effect */
@keyframes sparkle {
  0% { transform: scale(0) rotate(0); opacity: 1; }
  100% { transform: scale(1.5) rotate(180deg); opacity: 0; }
}
.sparkle {
  position: absolute;
  width: 20px;
  height: 20px;
  pointer-events: none;
}
.sparkle::before, .sparkle::after {
  content: 'âœ¦';
  position: absolute;
  font-size: 12px;
  color: var(--accent);
  animation: sparkle 0.6s ease forwards;
}
.sparkle::after { animation-delay: 0.1s; top: -8px; left: 8px; }

/* ===== Flip Card (Instant Composition) ===== */
.flip-cards-container { perspective: 1000px; }
.flip-card {
  width: 100%;
  min-height: 200px;
  cursor: pointer;
  perspective: 1000px;
  margin-bottom: 16px;
}
.flip-card-inner {
  position: relative;
  width: 100%;
  min-height: 200px;
  transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  transform-style: preserve-3d;
}
.flip-card.flipped .flip-card-inner { transform: rotateY(180deg); }
.flip-card-front, .flip-card-back {
  position: absolute;
  inset: 0;
  backface-visibility: hidden;
  border-radius: var(--radius-lg);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 24px;
  text-align: center;
}
.flip-card-front {
  background: linear-gradient(135deg, var(--main) 0%, var(--main-light) 100%);
  color: var(--white);
  box-shadow: var(--shadow-lg);
}
.flip-card-back {
  background: var(--white);
  color: var(--main);
  transform: rotateY(180deg);
  box-shadow: var(--shadow-lg);
  border: 2px solid var(--sub-light);
}
.flip-card-front .flip-label { font-size: 0.75rem; opacity: 0.8; margin-bottom: 12px; }
.flip-card-front .flip-jp { font-size: 1.2rem; font-weight: 700; line-height: 1.6; }
.flip-card-back .flip-label { font-size: 0.75rem; color: var(--text-light); margin-bottom: 12px; }
.flip-card-back .flip-en { font-family: var(--font-phrase); font-size: 1.3rem; font-weight: 700; line-height: 1.5; }
.flip-hint { font-size: 0.75rem; opacity: 0.6; margin-top: 16px; }

/* Self-report buttons */
.self-report {
  display: flex;
  gap: 12px;
  justify-content: center;
  margin-top: 12px;
}
.self-report button {
  padding: 10px 24px;
  border-radius: 999px;
  border: none;
  font-size: 0.9rem;
  font-weight: 600;
  cursor: pointer;
  font-family: var(--font-body);
  transition: var(--transition);
}
.btn-correct { background: var(--success); color: var(--white); }
.btn-incorrect { background: var(--gray-200); color: var(--gray-600); }
.btn-correct:hover { background: #219a52; }
.btn-incorrect:hover { background: var(--gray-300); }

/* ===== Quiz ===== */
.quiz-container { max-width: 600px; margin: 0 auto; }
.quiz-progress { font-size: 0.85rem; color: var(--text-light); margin-bottom: 16px; text-align: center; }
.quiz-question {
  background: var(--white);
  border-radius: var(--radius-lg);
  padding: 24px;
  margin-bottom: 16px;
  box-shadow: var(--shadow-md);
  text-align: center;
}
.quiz-question-text { font-size: 1.1rem; font-weight: 600; color: var(--main); margin-bottom: 20px; }
.quiz-options { display: flex; flex-direction: column; gap: 10px; }
.quiz-option {
  padding: 14px 18px;
  border-radius: var(--radius-md);
  border: 2px solid var(--gray-200);
  background: var(--white);
  cursor: pointer;
  font-size: 0.95rem;
  font-family: var(--font-phrase);
  transition: var(--transition);
  text-align: left;
}
.quiz-option:hover { border-color: var(--main-light); background: rgba(46,134,193,0.05); }
.quiz-option.correct { border-color: var(--success); background: rgba(39,174,96,0.08); color: var(--success); }
.quiz-option.incorrect { border-color: var(--accent-red); background: rgba(231,76,60,0.08); color: var(--accent-red); }

.quiz-result {
  text-align: center;
  padding: 32px;
  background: var(--white);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-md);
}
.quiz-score { font-family: var(--font-display); font-size: 2.5rem; font-weight: 800; color: var(--main); }
.quiz-score-label { color: var(--text-light); margin-bottom: 20px; }

/* ===== Buttons ===== */
.btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 10px 22px;
  border-radius: 999px;
  font-size: 0.9rem;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  border: none;
  font-family: var(--font-body);
}
.btn-primary { background: var(--main); color: var(--white); }
.btn-primary:hover { background: var(--main-dark); transform: translateY(-1px); }
.btn-accent { background: var(--accent); color: var(--white); }
.btn-accent:hover { background: var(--accent-orange); }
.btn-outline { background: transparent; border: 2px solid var(--main); color: var(--main); }
.btn-outline:hover { background: var(--main); color: var(--white); }
.btn-ghost { background: var(--gray-100); color: var(--gray-600); }
.btn-ghost:hover { background: var(--gray-200); }

/* ===== Form Elements ===== */
.input, .textarea {
  width: 100%;
  padding: 12px 16px;
  border: 2px solid var(--gray-200);
  border-radius: var(--radius-md);
  font-size: 0.95rem;
  font-family: var(--font-body);
  transition: var(--transition);
  background: var(--white);
  color: var(--text);
}
.input:focus, .textarea:focus { outline: none; border-color: var(--main-light); box-shadow: 0 0 0 3px rgba(46,134,193,0.15); }
.textarea { resize: vertical; min-height: 100px; }

/* ===== Search ===== */
.search-box {
  position: relative;
  margin-bottom: 16px;
}
.search-box .input { padding-left: 40px; }
.search-box::before {
  content: 'ğŸ”';
  position: absolute;
  left: 12px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 1rem;
}

/* ===== API / Loading ===== */
.loading-pal {
  text-align: center;
  padding: 40px;
}
.loading-pal .pal-bounce {
  animation: bounce 0.6s infinite alternate;
  display: inline-block;
  font-size: 3rem;
}
@keyframes bounce {
  from { transform: translateY(0); }
  to { transform: translateY(-12px); }
}
.loading-text { color: var(--text-light); margin-top: 12px; font-size: 0.9rem; }

.error-msg {
  background: rgba(231,76,60,0.08);
  border: 1px solid rgba(231,76,60,0.2);
  border-radius: var(--radius-md);
  padding: 16px;
  color: var(--accent-red);
  text-align: center;
  font-size: 0.9rem;
}

/* ===== Custom Phrase / Intro Cards ===== */
.saved-card {
  background: var(--white);
  border-radius: var(--radius-md);
  padding: 16px;
  margin-bottom: 10px;
  box-shadow: var(--shadow-sm);
  position: relative;
}
.saved-card-actions {
  display: flex;
  gap: 8px;
  margin-top: 10px;
}
.saved-card-actions button {
  font-size: 0.75rem;
  padding: 4px 12px;
  border-radius: 999px;
  border: 1px solid var(--gray-200);
  background: var(--white);
  cursor: pointer;
  color: var(--gray-500);
  transition: var(--transition);
}
.saved-card-actions button:hover { background: var(--gray-100); }
.saved-card-actions .delete-btn:hover { color: var(--accent-red); border-color: var(--accent-red); }

/* ===== Footer ===== */
.footer {
  text-align: center;
  padding: 24px 16px;
  color: var(--gray-400);
  font-size: 0.75rem;
}

/* ===== Pal Reactions ===== */
.pal-reaction {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 16px;
  border-radius: var(--radius-md);
  margin: 16px 0;
  animation: fadeIn 0.4s ease;
}
.pal-reaction.happy { background: rgba(39,174,96,0.08); border: 1px solid rgba(39,174,96,0.2); }
.pal-reaction.encourage { background: rgba(243,156,18,0.08); border: 1px solid rgba(243,156,18,0.2); }
.pal-reaction-text { font-size: 0.9rem; }

/* ===== Responsive ===== */
@media (min-width: 640px) {
  .section-grid { grid-template-columns: repeat(3, 1fr); }
  .hero-title { font-size: 2.5rem; }
  .page { padding: 32px 24px 80px; }
}
@media (min-width: 900px) {
  .section-grid { grid-template-columns: repeat(4, 1fr); }
}
@media (max-width: 380px) {
  .progress-summary { grid-template-columns: 1fr; }
  .section-grid { grid-template-columns: 1fr; }
  .logo-text { font-size: 1.1rem; }
}

/* ===== Tab content visibility ===== */
.tab-content { display: none; }
.tab-content.active { display: block; animation: fadeIn 0.3s ease; }

/* ===== Empty state ===== */
.empty-state {
  text-align: center;
  padding: 40px 20px;
  color: var(--gray-400);
}
.empty-state-icon { font-size: 2.5rem; margin-bottom: 12px; display: block; }
.empty-state-text { font-size: 0.9rem; }

/* ===== API key input ===== */
.api-key-section {
  background: rgba(243,156,18,0.06);
  border: 1px dashed var(--accent);
  border-radius: var(--radius-md);
  padding: 16px;
  margin-bottom: 20px;
  font-size: 0.85rem;
}
.api-key-section .input { font-size: 0.85rem; margin-top: 8px; }

/* My Phrase Book */
.my-phrases-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

/* Continuous mode nav */
.continuous-nav {
  display: flex;
  justify-content: center;
  gap: 12px;
  margin-top: 16px;
}
.card-counter {
  text-align: center;
  font-size: 0.85rem;
  color: var(--text-light);
  margin-bottom: 12px;
}
</style>
</head>
<body>

<!-- Header -->
<header class="header">
  <div class="header-inner">
    <a class="logo" onclick="navigateTo('home')">
      <span class="logo-icon">ğŸ§</span>
      <span class="logo-text">Travel English <span>Circus</span></span>
    </a>
    <button class="hamburger" id="hamburger" aria-label="Menu">
      <span></span><span></span><span></span>
    </button>
  </div>
</header>

<!-- Nav Overlay -->
<div class="nav-overlay" id="navOverlay"></div>

<!-- Side Navigation -->
<nav class="side-nav" id="sideNav">
  <div class="nav-section-title">Menu</div>
  <a class="nav-item active" onclick="navigateTo('home')">
    <span class="nav-icon">ğŸ </span> ãƒ›ãƒ¼ãƒ 
  </a>
  <a class="nav-item" onclick="navigateTo('intro')">
    <span class="nav-icon">ğŸ§</span> è‡ªå·±ç´¹ä»‹
  </a>
  <a class="nav-item" onclick="navigateTo('custom')">
    <span class="nav-icon">âœï¸</span> ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒ¬ãƒ¼ã‚º
  </a>
  <div class="nav-divider"></div>
  <div class="nav-section-title">Phrases</div>
  <a class="nav-item" onclick="navigateTo('helper')">
    <span class="nav-icon">ğŸ†˜</span> ãŠåŠ©ã‘ãƒ•ãƒ¬ãƒ¼ã‚º
  </a>
  <a class="nav-item" onclick="navigateTo('airport')">
    <span class="nav-icon">âœˆï¸</span> ç©ºæ¸¯ãƒ»æ©Ÿå†…
  </a>
  <a class="nav-item" onclick="navigateTo('transport')">
    <span class="nav-icon">ğŸš•</span> ç§»å‹•ãƒ»äº¤é€š
  </a>
  <a class="nav-item" onclick="navigateTo('hotel')">
    <span class="nav-icon">ğŸ¨</span> ãƒ›ãƒ†ãƒ«
  </a>
  <a class="nav-item" onclick="navigateTo('restaurant')">
    <span class="nav-icon">ğŸ½ï¸</span> ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ãƒ»ã‚«ãƒ•ã‚§
  </a>
  <a class="nav-item" onclick="navigateTo('shopping')">
    <span class="nav-icon">ğŸ›ï¸</span> ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°
  </a>
  <a class="nav-item" onclick="navigateTo('sightseeing')">
    <span class="nav-icon">ğŸ“¸</span> è¦³å…‰ãƒ»ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£
  </a>
  <a class="nav-item" onclick="navigateTo('trouble')">
    <span class="nav-icon">ğŸš¨</span> ãƒˆãƒ©ãƒ–ãƒ«ãƒ»ç·Šæ€¥
  </a>
  <a class="nav-item" onclick="navigateTo('smalltalk')">
    <span class="nav-icon">ğŸ’¬</span> ã‚¹ãƒ¢ãƒ¼ãƒ«ãƒˆãƒ¼ã‚¯
  </a>
  <div class="nav-divider"></div>
  <a class="nav-item" onclick="navigateTo('myphrases')">
    <span class="nav-icon">â­</span> ãƒã‚¤ãƒ•ãƒ¬ãƒ¼ã‚ºå¸³
  </a>
</nav>

<!-- Main Content -->
<main class="main">

<!-- Home Page -->
<div class="page active" id="page-home">
  <div class="hero">
    <div style="font-size:4rem;margin-bottom:12px">ğŸ§</div>
    <h1 class="hero-title">Travel English <span>Circus</span></h1>
    <p class="hero-subtitle">æµ·å¤–æ—…è¡Œã§ä½¿ãˆã‚‹è‹±èªãƒ•ãƒ¬ãƒ¼ã‚ºã®ç¬ç™ºåŠ›ã‚’é›ãˆã‚ˆã†ï¼</p>
  </div>

  <div class="pal-welcome">
    <div style="font-size:2rem">ğŸ§</div>
    <div class="pal-message">
      ã‚„ã‚ï¼ã¼ãã¯<strong>ãƒ‘ãƒ«</strong>ã€ã‚­ãƒŸã®æ—…ã®ç›¸æ£’ã ã‚ˆï¼<br>
      ä¸€ç·’ã«æ—…å…ˆã§ä½¿ãˆã‚‹ãƒ•ãƒ¬ãƒ¼ã‚ºã‚’ãŸãã•ã‚“ç·´ç¿’ã—ã‚ˆã†ã€‚<br>
      ãƒ‘ãƒƒã¨è‹±èªãŒå£ã‹ã‚‰å‡ºã‚‹ã‚ˆã†ã«ãªã‚‹ã¾ã§ã€ã¼ããŒå¿œæ´ã™ã‚‹ã‚ˆï¼
    </div>
  </div>

  <div class="progress-summary">
    <div class="progress-card">
      <div class="progress-num" id="favCount">0</div>
      <div class="progress-label">ãŠæ°—ã«å…¥ã‚Š</div>
    </div>
    <div class="progress-card">
      <div class="progress-num" id="learnCount">0</div>
      <div class="progress-label">ç·´ç¿’æ¸ˆã¿</div>
    </div>
    <div class="progress-card">
      <div class="progress-num" id="quizCount">0</div>
      <div class="progress-label">ã‚¯ã‚¤ã‚ºæ­£è§£</div>
    </div>
  </div>

  <h2 style="font-family:var(--font-display);font-size:1.2rem;color:var(--main);margin-bottom:16px;">ã‚»ã‚¯ã‚·ãƒ§ãƒ³ä¸€è¦§</h2>
  <div class="section-grid">
    <div class="section-card" onclick="navigateTo('intro')">
      <span class="card-icon">ğŸ§</span>
      <span class="card-title">è‡ªå·±ç´¹ä»‹</span>
      <span class="card-desc">è‹±èªã§è‡ªåˆ†ã‚’ç´¹ä»‹</span>
    </div>
    <div class="section-card" onclick="navigateTo('custom')">
      <span class="card-icon">âœï¸</span>
      <span class="card-title">ã‚«ã‚¹ã‚¿ãƒ </span>
      <span class="card-desc">è¨€ã„ãŸã„ã“ã¨ã‚’ç¿»è¨³</span>
    </div>
    <div class="section-card" onclick="navigateTo('helper')">
      <span class="card-icon">ğŸ†˜</span>
      <span class="card-title">ãŠåŠ©ã‘</span>
      <span class="card-desc">ä¸‡èƒ½ãƒ•ãƒ¬ãƒ¼ã‚ºé›†</span>
    </div>
    <div class="section-card" onclick="navigateTo('airport')">
      <span class="card-icon">âœˆï¸</span>
      <span class="card-title">ç©ºæ¸¯ãƒ»æ©Ÿå†…</span>
      <span class="card-desc">ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ã€œå…¥å›½</span>
    </div>
    <div class="section-card" onclick="navigateTo('transport')">
      <span class="card-icon">ğŸš•</span>
      <span class="card-title">ç§»å‹•ãƒ»äº¤é€š</span>
      <span class="card-desc">ã‚¿ã‚¯ã‚·ãƒ¼ãƒ»é›»è»Šç­‰</span>
    </div>
    <div class="section-card" onclick="navigateTo('hotel')">
      <span class="card-icon">ğŸ¨</span>
      <span class="card-title">ãƒ›ãƒ†ãƒ«</span>
      <span class="card-desc">ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ãƒ»è¦æœ›</span>
    </div>
    <div class="section-card" onclick="navigateTo('restaurant')">
      <span class="card-icon">ğŸ½ï¸</span>
      <span class="card-title">ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³</span>
      <span class="card-desc">æ³¨æ–‡ãƒ»ä¼šè¨ˆ</span>
    </div>
    <div class="section-card" onclick="navigateTo('shopping')">
      <span class="card-icon">ğŸ›ï¸</span>
      <span class="card-title">ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°</span>
      <span class="card-desc">è²·ã„ç‰©ãƒ»å…ç¨</span>
    </div>
    <div class="section-card" onclick="navigateTo('sightseeing')">
      <span class="card-icon">ğŸ“¸</span>
      <span class="card-title">è¦³å…‰</span>
      <span class="card-desc">ãƒã‚±ãƒƒãƒˆãƒ»æ’®å½±</span>
    </div>
    <div class="section-card" onclick="navigateTo('trouble')">
      <span class="card-icon">ğŸš¨</span>
      <span class="card-title">ãƒˆãƒ©ãƒ–ãƒ«</span>
      <span class="card-desc">ç·Šæ€¥ãƒ»ç´›å¤±</span>
    </div>
    <div class="section-card" onclick="navigateTo('smalltalk')">
      <span class="card-icon">ğŸ’¬</span>
      <span class="card-title">ã‚¹ãƒ¢ãƒ¼ãƒ«ãƒˆãƒ¼ã‚¯</span>
      <span class="card-desc">é›‘è«‡ãƒ»æŒ¨æ‹¶</span>
    </div>
    <div class="section-card" onclick="navigateTo('myphrases')">
      <span class="card-icon">â­</span>
      <span class="card-title">ãƒã‚¤ãƒ•ãƒ¬ãƒ¼ã‚º</span>
      <span class="card-desc">ãŠæ°—ã«å…¥ã‚Šä¸€è¦§</span>
    </div>
  </div>
</div>

<!-- Placeholder pages - will be filled in subsequent phases -->
<div class="page" id="page-intro"></div>
<div class="page" id="page-custom"></div>
<div class="page" id="page-helper"></div>
<div class="page" id="page-airport"></div>
<div class="page" id="page-transport"></div>
<div class="page" id="page-hotel"></div>
<div class="page" id="page-restaurant"></div>
<div class="page" id="page-shopping"></div>
<div class="page" id="page-sightseeing"></div>
<div class="page" id="page-trouble"></div>
<div class="page" id="page-smalltalk"></div>
<div class="page" id="page-myphrases"></div>

</main>

<footer class="footer">
  <p>Travel English Circus &copy; 2026 â€” Your travel buddy Pal ğŸ§</p>
</footer>

<script>
// ===== Navigation =====
const hamburger = document.getElementById('hamburger');
const sideNav = document.getElementById('sideNav');
const navOverlay = document.getElementById('navOverlay');

function toggleNav() {
  hamburger.classList.toggle('active');
  sideNav.classList.toggle('active');
  navOverlay.classList.toggle('active');
  document.body.style.overflow = sideNav.classList.contains('active') ? 'hidden' : '';
}
hamburger.addEventListener('click', toggleNav);
navOverlay.addEventListener('click', toggleNav);

function navigateTo(pageId) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  const target = document.getElementById('page-' + pageId);
  if (target) target.classList.add('active');
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => {
    if (n.getAttribute('onclick') && n.getAttribute('onclick').includes("'" + pageId + "'")) {
      n.classList.add('active');
    }
  });
  if (sideNav.classList.contains('active')) toggleNav();
  window.scrollTo({ top: 0, behavior: 'smooth' });
  if (pageId === 'home') updateProgressSummary();
  if (pageId === 'myphrases') renderMyPhrases();
}

// ===== localStorage helpers =====
const STORAGE_PREFIX = 'tec_';
function storageGet(key, fallback) {
  try {
    const v = localStorage.getItem(STORAGE_PREFIX + key);
    return v ? JSON.parse(v) : fallback;
  } catch { return fallback; }
}
function storageSet(key, value) {
  try { localStorage.setItem(STORAGE_PREFIX + key, JSON.stringify(value)); } catch {}
}

// ===== Favorites =====
let favorites = storageGet('favorites', []);

function toggleFavorite(phraseId) {
  const idx = favorites.indexOf(phraseId);
  const adding = idx === -1;
  if (adding) {
    favorites.push(phraseId);
    // Sparkle effect
    const btn = document.querySelector(`.fav-btn[data-phrase-id="${phraseId}"]`);
    if (btn) {
      const sparkle = document.createElement('div');
      sparkle.className = 'sparkle';
      btn.style.position = 'relative';
      btn.appendChild(sparkle);
      setTimeout(() => sparkle.remove(), 700);
    }
  } else {
    favorites.splice(idx, 1);
  }
  storageSet('favorites', favorites);
  updateAllFavButtons();
  updateProgressSummary();
}

function isFavorite(phraseId) {
  return favorites.includes(phraseId);
}

function updateAllFavButtons() {
  document.querySelectorAll('.fav-btn').forEach(btn => {
    const id = btn.dataset.phraseId;
    btn.classList.toggle('active', isFavorite(id));
    btn.textContent = isFavorite(id) ? 'â˜…' : 'â˜†';
  });
}

// ===== Learning Records =====
let learnedPhrases = storageGet('learned', []);
let quizCorrect = storageGet('quizCorrect', 0);

function markLearned(phraseId) {
  if (!learnedPhrases.includes(phraseId)) {
    learnedPhrases.push(phraseId);
    storageSet('learned', learnedPhrases);
  }
}

function updateProgressSummary() {
  document.getElementById('favCount').textContent = favorites.length;
  document.getElementById('learnCount').textContent = learnedPhrases.length;
  document.getElementById('quizCount').textContent = quizCorrect;
}

// ===== Phrase Data Store (populated by each scene) =====
const allPhrases = {};

function registerPhrases(sceneId, phrases) {
  allPhrases[sceneId] = phrases;
}

function getAllPhrasesFlat() {
  const result = [];
  for (const scene in allPhrases) {
    allPhrases[scene].forEach(p => result.push({ ...p, scene }));
  }
  return result;
}

// ===== Scene Page Renderer =====
function renderScenePage(pageId, icon, title, phrases, quizData) {
  const page = document.getElementById('page-' + pageId);
  if (!page) return;

  registerPhrases(pageId, phrases);

  let html = `
    <div class="page-header">
      <span class="page-header-icon">${icon}</span>
      <h1 class="page-header-title">${title}</h1>
    </div>
    <div class="mode-tabs">
      <button class="mode-tab active" onclick="switchMode('${pageId}','list')">ãƒ•ãƒ¬ãƒ¼ã‚ºä¸€è¦§</button>
      <button class="mode-tab" onclick="switchMode('${pageId}','flash')">ç¬é–“è‹±ä½œæ–‡</button>
      <button class="mode-tab" onclick="switchMode('${pageId}','quiz')">ãƒŸãƒ‹ã‚¯ã‚¤ã‚º</button>
    </div>

    <div class="tab-content active" id="${pageId}-list">
      <div class="politeness-toggle">
        <span>ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«</span>
        <div class="toggle-switch" id="${pageId}-toggle" onclick="togglePoliteness('${pageId}')"></div>
        <span>ãƒãƒ©ã‚¤ãƒˆ</span>
      </div>
      <div id="${pageId}-phrases"></div>
    </div>

    <div class="tab-content" id="${pageId}-flash">
      <div class="card-counter" id="${pageId}-flash-counter"></div>
      <div id="${pageId}-flash-area"></div>
      <div class="continuous-nav">
        <button class="btn btn-ghost" onclick="flashPrev('${pageId}')">â† å‰</button>
        <button class="btn btn-primary" onclick="flashNext('${pageId}')">æ¬¡ â†’</button>
      </div>
    </div>

    <div class="tab-content" id="${pageId}-quiz">
      <div id="${pageId}-quiz-area"></div>
    </div>
  `;
  page.innerHTML = html;

  renderPhraseList(pageId);
  initFlashCards(pageId);
  if (quizData) initQuiz(pageId, quizData);
}

function switchMode(pageId, mode) {
  const tabs = document.querySelectorAll(`#page-${pageId} .mode-tab`);
  const contents = document.querySelectorAll(`#page-${pageId} .tab-content`);
  tabs.forEach(t => t.classList.remove('active'));
  contents.forEach(c => c.classList.remove('active'));
  document.getElementById(`${pageId}-${mode}`).classList.add('active');
  const modeIdx = { list: 0, flash: 1, quiz: 2 }[mode];
  if (tabs[modeIdx]) tabs[modeIdx].classList.add('active');
}

// ===== Phrase List Rendering =====
const politenessState = {};

function togglePoliteness(pageId) {
  politenessState[pageId] = !politenessState[pageId];
  const toggle = document.getElementById(pageId + '-toggle');
  toggle.classList.toggle('polite', politenessState[pageId]);
  renderPhraseList(pageId);
}

function renderPhraseList(pageId) {
  const phrases = allPhrases[pageId];
  if (!phrases) return;
  const container = document.getElementById(pageId + '-phrases');
  const isPolite = politenessState[pageId];

  container.innerHTML = phrases.map(p => {
    const en = isPolite && p.polite ? p.polite : p.casual;
    const favClass = isFavorite(p.id) ? 'active' : '';
    const favIcon = isFavorite(p.id) ? 'â˜…' : 'â˜†';
    return `
      <div class="phrase-card">
        <button class="fav-btn ${favClass}" data-phrase-id="${p.id}" onclick="toggleFavorite('${p.id}');event.stopPropagation();">${favIcon}</button>
        <div class="phrase-jp">${p.jp}</div>
        <div class="phrase-en">${en}</div>
        ${p.note ? `<div class="phrase-note">${p.note}</div>` : ''}
      </div>
    `;
  }).join('');
}

// ===== Flash Cards =====
const flashState = {};

function initFlashCards(pageId) {
  const phrases = allPhrases[pageId];
  if (!phrases) return;
  flashState[pageId] = { index: 0, flipped: false };
  renderFlashCard(pageId);
}

function renderFlashCard(pageId) {
  const phrases = allPhrases[pageId];
  const state = flashState[pageId];
  if (!phrases || !state) return;
  const p = phrases[state.index];
  const isPolite = politenessState[pageId];
  const en = isPolite && p.polite ? p.polite : p.casual;

  document.getElementById(pageId + '-flash-counter').textContent = `${state.index + 1} / ${phrases.length}`;
  document.getElementById(pageId + '-flash-area').innerHTML = `
    <div class="flip-card ${state.flipped ? 'flipped' : ''}" onclick="flipCard('${pageId}')">
      <div class="flip-card-inner">
        <div class="flip-card-front">
          <div class="flip-label">æ—¥æœ¬èª</div>
          <div class="flip-jp">${p.jp}</div>
          <div class="flip-hint">ã‚¿ãƒƒãƒ—ã§è‹±èªã‚’è¡¨ç¤º</div>
        </div>
        <div class="flip-card-back">
          <div class="flip-label">English</div>
          <div class="flip-en">${en}</div>
        </div>
      </div>
    </div>
    ${state.flipped ? `
      <div class="self-report">
        <button class="btn-correct" onclick="reportResult('${pageId}','${p.id}',true)">è¨€ãˆãŸï¼ ğŸ˜Š</button>
        <button class="btn-incorrect" onclick="reportResult('${pageId}','${p.id}',false)">ã‚‚ã†ä¸€å› ğŸ’ª</button>
      </div>
    ` : ''}
  `;
}

function flipCard(pageId) {
  flashState[pageId].flipped = !flashState[pageId].flipped;
  renderFlashCard(pageId);
}

function flashNext(pageId) {
  const phrases = allPhrases[pageId];
  const state = flashState[pageId];
  state.index = (state.index + 1) % phrases.length;
  state.flipped = false;
  renderFlashCard(pageId);
}

function flashPrev(pageId) {
  const phrases = allPhrases[pageId];
  const state = flashState[pageId];
  state.index = (state.index - 1 + phrases.length) % phrases.length;
  state.flipped = false;
  renderFlashCard(pageId);
}

function reportResult(pageId, phraseId, correct) {
  markLearned(phraseId);
  if (correct) {
    // show brief happy reaction, then next
  }
  flashNext(pageId);
}

// ===== Quiz =====
const quizState = {};

function initQuiz(pageId, quizData) {
  quizState[pageId] = { questions: quizData, current: 0, score: 0, answered: false };
  renderQuizQuestion(pageId);
}

function renderQuizQuestion(pageId) {
  const state = quizState[pageId];
  if (!state) return;
  const area = document.getElementById(pageId + '-quiz-area');

  if (state.current >= state.questions.length) {
    quizCorrect += state.score;
    storageSet('quizCorrect', quizCorrect);
    area.innerHTML = `
      <div class="quiz-result">
        <div style="font-size:3rem;margin-bottom:12px">ğŸ§</div>
        <div class="quiz-score">${state.score} / ${state.questions.length}</div>
        <div class="quiz-score-label">æ­£è§£</div>
        <div class="pal-reaction ${state.score >= 3 ? 'happy' : 'encourage'}" style="justify-content:center;margin-top:16px">
          <span>${state.score >= 3 ? 'ã™ã”ã„ï¼ãƒ‘ãƒ«ã‚‚å¬‰ã—ã„ã‚ˆï¼ğŸ‰' : 'ã„ã„èª¿å­ï¼ã‚‚ã†ä¸€å›ã‚„ã£ã¦ã¿ã‚ˆã†ï¼ğŸ’ª'}</span>
        </div>
        <button class="btn btn-primary" style="margin-top:20px" onclick="retryQuiz('${pageId}')">ã‚‚ã†ä¸€å›ãƒãƒ£ãƒ¬ãƒ³ã‚¸</button>
      </div>
    `;
    updateProgressSummary();
    return;
  }

  const q = state.questions[state.current];
  area.innerHTML = `
    <div class="quiz-progress">å•é¡Œ ${state.current + 1} / ${state.questions.length}</div>
    <div class="quiz-question">
      <div class="quiz-question-text">${q.jp}</div>
      <div class="quiz-options">
        ${q.options.map((opt, i) => `
          <div class="quiz-option" onclick="answerQuiz('${pageId}', ${i}, ${q.answer})">${opt}</div>
        `).join('')}
      </div>
      <div id="${pageId}-quiz-feedback"></div>
    </div>
  `;
}

function answerQuiz(pageId, selected, correct) {
  const state = quizState[pageId];
  if (state.answered) return;
  state.answered = true;

  const options = document.querySelectorAll(`#page-${pageId} .quiz-option`);
  options[correct].classList.add('correct');
  if (selected !== correct) {
    options[selected].classList.add('incorrect');
  } else {
    state.score++;
  }

  const feedback = document.getElementById(pageId + '-quiz-feedback');
  if (selected === correct) {
    feedback.innerHTML = `<div class="pal-reaction happy"><span>ğŸ§</span><span class="pal-reaction-text">æ­£è§£ï¼ Great job! ğŸ‰</span></div>`;
  } else {
    feedback.innerHTML = `<div class="pal-reaction encourage"><span>ğŸ§</span><span class="pal-reaction-text">æƒœã—ã„ï¼æ¬¡ã¯ãã£ã¨ã§ãã‚‹ã‚ˆï¼ğŸ’ª</span></div>`;
  }

  setTimeout(() => {
    state.current++;
    state.answered = false;
    renderQuizQuestion(pageId);
  }, 1500);
}

function retryQuiz(pageId) {
  const state = quizState[pageId];
  state.current = 0;
  state.score = 0;
  state.answered = false;
  renderQuizQuestion(pageId);
}

// ===== My Phrases Page =====
function renderMyPhrases() {
  const page = document.getElementById('page-myphrases');
  const allFlat = getAllPhrasesFlat();
  const favPhrases = allFlat.filter(p => isFavorite(p.id));

  let html = `
    <div class="page-header">
      <span class="page-header-icon">â­</span>
      <h1 class="page-header-title">ãƒã‚¤ãƒ•ãƒ¬ãƒ¼ã‚ºå¸³</h1>
    </div>
  `;

  if (favPhrases.length === 0) {
    html += `<div class="empty-state"><span class="empty-state-icon">â­</span><div class="empty-state-text">ãŠæ°—ã«å…¥ã‚Šãƒ•ãƒ¬ãƒ¼ã‚ºãŒã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚<br>å„ãƒšãƒ¼ã‚¸ã® â˜† ãƒœã‚¿ãƒ³ã§ãƒ•ãƒ¬ãƒ¼ã‚ºã‚’è¿½åŠ ã—ã‚ˆã†ï¼</div></div>`;
  } else {
    html += `<p style="color:var(--text-light);font-size:0.85rem;margin-bottom:16px">${favPhrases.length} ãƒ•ãƒ¬ãƒ¼ã‚º</p>`;
    html += `<div class="mode-tabs"><button class="mode-tab active" onclick="switchMyPhrasesMode('list')">ä¸€è¦§</button><button class="mode-tab" onclick="switchMyPhrasesMode('flash')">ç¬é–“è‹±ä½œæ–‡</button></div>`;
    html += `<div id="myphrases-list" class="tab-content active">`;
    favPhrases.forEach(p => {
      html += `
        <div class="phrase-card">
          <button class="fav-btn active" data-phrase-id="${p.id}" onclick="toggleFavorite('${p.id}');renderMyPhrases();event.stopPropagation();">â˜…</button>
          <div class="phrase-jp">${p.jp}</div>
          <div class="phrase-en">${p.casual}</div>
        </div>
      `;
    });
    html += `</div>`;
    html += `<div id="myphrases-flash" class="tab-content"><div id="myphrases-flash-counter" class="card-counter"></div><div id="myphrases-flash-area"></div><div class="continuous-nav"><button class="btn btn-ghost" onclick="myFlashPrev()">â† å‰</button><button class="btn btn-primary" onclick="myFlashNext()">æ¬¡ â†’</button></div></div>`;
  }

  page.innerHTML = html;
}

let myFlashIdx = 0;
function switchMyPhrasesMode(mode) {
  document.querySelectorAll('#page-myphrases .mode-tab').forEach((t,i) => t.classList.toggle('active', (mode==='list'?0:1)===i));
  document.getElementById('myphrases-list').classList.toggle('active', mode==='list');
  document.getElementById('myphrases-flash').classList.toggle('active', mode==='flash');
  if (mode==='flash') { myFlashIdx=0; renderMyFlash(); }
}
function renderMyFlash() {
  const allFlat = getAllPhrasesFlat();
  const favPhrases = allFlat.filter(p => isFavorite(p.id));
  if (!favPhrases.length) return;
  const p = favPhrases[myFlashIdx % favPhrases.length];
  document.getElementById('myphrases-flash-counter').textContent = `${myFlashIdx%favPhrases.length+1} / ${favPhrases.length}`;
  const flipped = document.getElementById('myphrases-flash-area').dataset.flipped === 'true';
  document.getElementById('myphrases-flash-area').innerHTML = `
    <div class="flip-card ${flipped?'flipped':''}" onclick="document.getElementById('myphrases-flash-area').dataset.flipped=document.getElementById('myphrases-flash-area').dataset.flipped==='true'?'false':'true';renderMyFlash();">
      <div class="flip-card-inner">
        <div class="flip-card-front"><div class="flip-label">æ—¥æœ¬èª</div><div class="flip-jp">${p.jp}</div><div class="flip-hint">ã‚¿ãƒƒãƒ—ã§è‹±èªã‚’è¡¨ç¤º</div></div>
        <div class="flip-card-back"><div class="flip-label">English</div><div class="flip-en">${p.casual}</div></div>
      </div>
    </div>`;
}
function myFlashNext() { myFlashIdx++; document.getElementById('myphrases-flash-area').dataset.flipped='false'; renderMyFlash(); }
function myFlashPrev() { myFlashIdx = Math.max(0, myFlashIdx-1); document.getElementById('myphrases-flash-area').dataset.flipped='false'; renderMyFlash(); }

// ===== Helper Phrases Page =====
(function() {
  const categories = [
    { name: 'èãè¿”ã™', icon: 'ğŸ‘‚', phrases: [
      { id:'h01', jp:'ã™ã¿ã¾ã›ã‚“ã€ã‚‚ã†ä¸€åº¦è¨€ã£ã¦ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿ', casual:'Sorry, could you say that again?', polite:'I\'m sorry, would you mind repeating that?' },
      { id:'h02', jp:'ã‚‚ã†å°‘ã—ã‚†ã£ãã‚Šè©±ã—ã¦ã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿ', casual:'Could you speak a bit slower?', polite:'Would you mind speaking a little more slowly, please?' },
      { id:'h03', jp:'ãã‚Œã¯ã©ã†ã„ã†æ„å‘³ã§ã™ã‹ï¼Ÿ', casual:'What does that mean?', polite:'Could you tell me what that means?' },
      { id:'h04', jp:'æ›¸ã„ã¦ã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿ', casual:'Can you write it down?', polite:'Would you mind writing that down for me?' },
      { id:'h05', jp:'è‹±èªãŒã‚ã¾ã‚Šå¾—æ„ã§ã¯ã‚ã‚Šã¾ã›ã‚“', casual:'My English isn\'t great.', polite:'I\'m afraid my English is rather limited.' },
      { id:'h06', jp:'èãå–ã‚Œã¾ã›ã‚“ã§ã—ãŸ', casual:'I didn\'t catch that.', polite:'I\'m sorry, I didn\'t quite catch that.' },
      { id:'h07', jp:'ã‚‚ã†ä¸€åº¦ãŠé¡˜ã„ã—ã¾ã™', casual:'One more time, please?', polite:'Could you say that one more time, please?' },
      { id:'h08', jp:'ä½•ã¨è¨€ã„ã¾ã—ãŸã‹ï¼Ÿ', casual:'What did you say?', polite:'I beg your pardon?' },
      { id:'h09', jp:'â—‹â—‹ã¨ã„ã†ã“ã¨ã§ã™ã‹ï¼Ÿ', casual:'You mean ___?', polite:'Do you mean ___?' },
      { id:'h10', jp:'ã™ã¿ã¾ã›ã‚“ã€èã“ãˆã¾ã›ã‚“ã§ã—ãŸ', casual:'Sorry, I couldn\'t hear you.', polite:'I\'m sorry, I couldn\'t quite hear you.' },
    ]},
    { name: 'ãŠç¤¼', icon: 'ğŸ™', phrases: [
      { id:'h11', jp:'ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€åŠ©ã‹ã‚Šã¾ã™', casual:'Thanks, that\'s really helpful!', polite:'Thank you so much, that\'s very helpful.' },
      { id:'h12', jp:'ã”è¦ªåˆ‡ã«ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™', casual:'That\'s so kind of you!', polite:'That\'s very kind of you, thank you.' },
      { id:'h13', jp:'ã‚ã–ã‚ã–ã™ã¿ã¾ã›ã‚“', casual:'Sorry for the trouble!', polite:'I appreciate you going out of your way.' },
      { id:'h14', jp:'ãŠã‹ã’ã•ã¾ã§åŠ©ã‹ã‚Šã¾ã—ãŸ', casual:'You saved me!', polite:'I really appreciate your help.' },
      { id:'h15', jp:'ç´ æ™´ã‚‰ã—ã„ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã­', casual:'Great service!', polite:'The service here is wonderful.' },
      { id:'h16', jp:'ã¨ã¦ã‚‚æ¥½ã—ã‹ã£ãŸã§ã™', casual:'I had a blast!', polite:'I had a wonderful time, thank you.' },
      { id:'h17', jp:'æœ¬å½“ã«ã‚ã‚ŠãŒã¨ã†', casual:'Thanks a lot!', polite:'Thank you ever so much.' },
      { id:'h18', jp:'ã”ä¸å¯§ã«ã©ã†ã‚‚', casual:'Thanks for explaining!', polite:'I appreciate you taking the time to explain.' },
      { id:'h19', jp:'æœ€é«˜ã§ã™ï¼', casual:'This is awesome!', polite:'This is absolutely wonderful.' },
      { id:'h20', jp:'ã‚ãªãŸã®ãŠã‹ã’ã§ã™', casual:'It\'s all thanks to you!', polite:'I couldn\'t have done it without your help.' },
    ]},
    { name: 'è¬ã‚‹', icon: 'ğŸ™‡', phrases: [
      { id:'h21', jp:'ã™ã¿ã¾ã›ã‚“', casual:'Sorry about that.', polite:'I\'m terribly sorry about that.' },
      { id:'h22', jp:'é–“é•ãˆã¾ã—ãŸ', casual:'My bad.', polite:'I apologise, that was my mistake.' },
      { id:'h23', jp:'ãŠæ‰‹æ•°ãŠã‹ã‘ã—ã¾ã™', casual:'Sorry for the hassle.', polite:'I\'m sorry for the inconvenience.' },
      { id:'h24', jp:'é…ã‚Œã¦ã™ã¿ã¾ã›ã‚“', casual:'Sorry I\'m late!', polite:'I apologise for being late.' },
      { id:'h25', jp:'ã†ã£ã‹ã‚Šã—ã¦ã„ã¾ã—ãŸ', casual:'I wasn\'t paying attention.', polite:'I\'m afraid I wasn\'t paying attention.' },
    ]},
    { name: 'åŠ©ã‘ã‚’æ±‚ã‚ã‚‹', icon: 'ğŸ¤', phrases: [
      { id:'h26', jp:'æ‰‹ä¼ã£ã¦ã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿ', casual:'Can you help me?', polite:'Could you possibly help me?' },
      { id:'h27', jp:'ã¡ã‚‡ã£ã¨ã„ã„ã§ã™ã‹ï¼Ÿ', casual:'Got a sec?', polite:'Excuse me, do you have a moment?' },
      { id:'h28', jp:'æ—¥æœ¬èªã‚’è©±ã›ã‚‹æ–¹ã¯ã„ã¾ã™ã‹ï¼Ÿ', casual:'Does anyone speak Japanese?', polite:'Is there anyone who speaks Japanese, by any chance?' },
      { id:'h29', jp:'é“ã«è¿·ã£ã¦ã„ã¾ã™', casual:'I\'m lost.', polite:'I\'m afraid I\'m a bit lost.' },
      { id:'h30', jp:'ã“ã‚Œã‚’ãŠé¡˜ã„ã—ã¦ã‚‚ã„ã„ã§ã™ã‹ï¼Ÿ', casual:'Can you do this for me?', polite:'Would it be possible for you to help me with this?' },
      { id:'h31', jp:'Wi-Fiã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ', casual:'Do you have Wi-Fi?', polite:'Is there Wi-Fi available here?' },
      { id:'h32', jp:'å……é›»ã•ã›ã¦ã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿ', casual:'Can I charge my phone here?', polite:'Would it be alright if I charged my phone?' },
    ]},
    { name: 'ã‚ã‹ã‚‰ãªã„', icon: 'ğŸ¤”', phrases: [
      { id:'h33', jp:'ã‚ˆãã‚ã‹ã‚Šã¾ã›ã‚“', casual:'I\'m not sure.', polite:'I\'m not quite sure what you mean.' },
      { id:'h34', jp:'ãã‚Œã¯çŸ¥ã‚Šã¾ã›ã‚“', casual:'I don\'t know about that.', polite:'I\'m afraid I\'m not familiar with that.' },
      { id:'h35', jp:'åˆã‚ã¦æ¥ã¾ã—ãŸ', casual:'It\'s my first time here.', polite:'This is my first visit here.' },
      { id:'h36', jp:'ã“ã®è¾ºã‚Šã¯è©³ã—ãã‚ã‚Šã¾ã›ã‚“', casual:'I\'m not from around here.', polite:'I\'m not very familiar with this area, I\'m afraid.' },
      { id:'h37', jp:'è€ƒãˆã•ã›ã¦ãã ã•ã„', casual:'Let me think about it.', polite:'Could I have a moment to think about it?' },
    ]},
    { name: 'æ™‚é–“ç¨¼ã', icon: 'â³', phrases: [
      { id:'h38', jp:'ã¡ã‚‡ã£ã¨å¾…ã£ã¦ãã ã•ã„', casual:'Hang on a sec.', polite:'Just a moment, please.' },
      { id:'h39', jp:'èª¿ã¹ã¦ã¿ã¾ã™', casual:'Let me look it up.', polite:'Let me check on that for you.' },
      { id:'h40', jp:'ãˆãƒ¼ã¨â€¦', casual:'Um, let me see...', polite:'Well, let me think...' },
      { id:'h41', jp:'ç¢ºèªã•ã›ã¦ãã ã•ã„', casual:'Let me double-check.', polite:'Could I just confirm that?' },
      { id:'h42', jp:'ã™ãæˆ»ã‚Šã¾ã™', casual:'I\'ll be right back.', polite:'I\'ll be back in just a moment.' },
    ]},
  ];

  const page = document.getElementById('page-helper');
  const allHelperPhrases = categories.flatMap(c => c.phrases);
  registerPhrases('helper', allHelperPhrases);

  let currentCat = 'all';
  function render() {
    let html = `<div class="page-header"><span class="page-header-icon">ğŸ†˜</span><h1 class="page-header-title">ãŠåŠ©ã‘ãƒ•ãƒ¬ãƒ¼ã‚º</h1></div>`;
    html += `<div class="pal-welcome" style="margin-bottom:20px"><div style="font-size:1.5rem">ğŸ§</div><div class="pal-message">å›°ã£ãŸã¨ãã¯ã“ã“ã‚’è¦‹ã¦ã­ï¼ã©ã‚“ãªå ´é¢ã§ã‚‚ä½¿ãˆã‚‹<strong>ä¸‡èƒ½ãƒ•ãƒ¬ãƒ¼ã‚º</strong>ã‚’é›†ã‚ãŸã‚ˆã€‚</div></div>`;
    html += `<div class="mode-tabs" style="margin-bottom:20px">`;
    html += `<button class="mode-tab ${currentCat==='all'?'active':''}" onclick="window._helperFilter('all')">ã™ã¹ã¦</button>`;
    categories.forEach(c => {
      html += `<button class="mode-tab ${currentCat===c.name?'active':''}" onclick="window._helperFilter('${c.name}')">${c.icon} ${c.name}</button>`;
    });
    html += `</div>`;

    const filteredCats = currentCat === 'all' ? categories : categories.filter(c => c.name === currentCat);
    filteredCats.forEach(cat => {
      html += `<h3 style="font-family:var(--font-display);font-size:1.1rem;color:var(--main);margin:20px 0 10px">${cat.icon} ${cat.name}</h3>`;
      cat.phrases.forEach(p => {
        const favClass = isFavorite(p.id) ? 'active' : '';
        const favIcon = isFavorite(p.id) ? 'â˜…' : 'â˜†';
        html += `<div class="phrase-card"><button class="fav-btn ${favClass}" data-phrase-id="${p.id}" onclick="toggleFavorite('${p.id}');window._helperRender();event.stopPropagation();">${favIcon}</button><div class="phrase-jp">${p.jp}</div><div class="phrase-en">${p.casual}</div></div>`;
      });
    });
    page.innerHTML = html;
  }
  window._helperFilter = function(cat) { currentCat = cat; render(); };
  window._helperRender = render;
  render();
})();

// ===== Airport Phrases =====
(function() {
  const phrases = [
    { id:'a01', jp:'ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ã‚’ãŠé¡˜ã„ã—ã¾ã™', casual:'I\'d like to check in.', polite:'I\'d like to check in for my flight, please.' },
    { id:'a02', jp:'çª“å´ã®å¸­ã‚’ãŠé¡˜ã„ã§ãã¾ã™ã‹ï¼Ÿ', casual:'Can I get a window seat?', polite:'Could I possibly have a window seat, please?' },
    { id:'a03', jp:'é€šè·¯å´ã®å¸­ãŒã„ã„ã®ã§ã™ãŒ', casual:'I\'d prefer an aisle seat.', polite:'Would it be possible to have an aisle seat?' },
    { id:'a04', jp:'ã“ã®è·ç‰©ã¯æ©Ÿå†…æŒã¡è¾¼ã¿ã§ãã¾ã™ã‹ï¼Ÿ', casual:'Can I take this on the plane?', polite:'Is this within the carry-on size limit?' },
    { id:'a05', jp:'è·ç‰©ã‚’é ã‘ãŸã„ã®ã§ã™ãŒ', casual:'I need to check this bag.', polite:'I\'d like to check this bag in, please.' },
    { id:'a06', jp:'æ­ä¹—ã‚²ãƒ¼ãƒˆã¯ã©ã“ã§ã™ã‹ï¼Ÿ', casual:'Where\'s the gate?', polite:'Could you tell me where the boarding gate is?' },
    { id:'a07', jp:'ä¹—ã‚Šç¶™ããŒã‚ã‚‹ã®ã§ã™ãŒ', casual:'I have a connecting flight.', polite:'I have a connecting flight to catch.' },
    { id:'a08', jp:'ä¹—ã‚Šç¶™ãæ™‚é–“ã«é–“ã«åˆã„ã¾ã™ã‹ï¼Ÿ', casual:'Will I make my connection?', polite:'Do you think I\'ll be able to make my connecting flight?' },
    { id:'a09', jp:'æ—…è¡Œã§æ¥ã¾ã—ãŸ', casual:'I\'m here on holiday.', polite:'I\'m visiting for holiday purposes.' },
    { id:'a10', jp:'5æ—¥é–“æ»åœ¨ã—ã¾ã™', casual:'I\'m staying for five days.', polite:'I\'ll be staying for five days.' },
    { id:'a11', jp:'ã“ã®ãƒ›ãƒ†ãƒ«ã«æ³Šã¾ã‚Šã¾ã™', casual:'I\'m staying at this hotel.', polite:'I\'ll be staying at this hotel here.' },
    { id:'a12', jp:'ç”³å‘Šã™ã‚‹ã‚‚ã®ã¯ã‚ã‚Šã¾ã›ã‚“', casual:'Nothing to declare.', polite:'I have nothing to declare.' },
    { id:'a13', jp:'ã“ã‚Œã¯å€‹äººç”¨ã®ãŠåœŸç”£ã§ã™', casual:'These are personal souvenirs.', polite:'These are souvenirs for personal use.' },
    { id:'a14', jp:'æ¯›å¸ƒã‚’ã‚‚ã†ä¸€æšã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿ', casual:'Can I get another blanket?', polite:'Could I have an extra blanket, please?' },
    { id:'a15', jp:'é£²ã¿ç‰©ã‚’ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿ', casual:'Can I get something to drink?', polite:'Could I have something to drink, please?' },
    { id:'a16', jp:'ãƒ“ãƒ¼ãƒ•ã¨ãƒã‚­ãƒ³ã€ã©ã¡ã‚‰ã«ã—ã¾ã™ã‹ï¼Ÿï¼ˆã«å¯¾ã—ã¦ï¼‰ãƒã‚­ãƒ³ã‚’ãŠé¡˜ã„ã—ã¾ã™', casual:'Chicken, please.', polite:'I\'ll have the chicken, please.' },
    { id:'a17', jp:'ã™ã¿ã¾ã›ã‚“ã€é€šã—ã¦ã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿ', casual:'Excuse me, can I get through?', polite:'Excuse me, would you mind letting me through?' },
    { id:'a18', jp:'å…¥å›½ã‚«ãƒ¼ãƒ‰ã®æ›¸ãæ–¹ãŒã‚ã‹ã‚Šã¾ã›ã‚“', casual:'How do I fill this out?', polite:'Could you help me with this arrival card?' },
    { id:'a19', jp:'é ã‘ãŸè·ç‰©ãŒå‡ºã¦ãã¾ã›ã‚“', casual:'My bag hasn\'t come out.', polite:'I\'m afraid my luggage hasn\'t arrived on the carousel.' },
    { id:'a20', jp:'ãƒ•ãƒ©ã‚¤ãƒˆãŒé…å»¶ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ', casual:'Is the flight delayed?', polite:'Could you tell me if there\'s a delay on this flight?' },
    { id:'a21', jp:'ç©ºæ¸¯å†…ã«ATMã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ', casual:'Is there an ATM around here?', polite:'Could you tell me where I might find an ATM?' },
    { id:'a22', jp:'Wi-Fiã«æ¥ç¶šã™ã‚‹ã«ã¯ã©ã†ã™ã‚Œã°ï¼Ÿ', casual:'How do I connect to Wi-Fi?', polite:'Could you tell me how to connect to the Wi-Fi?' },
    { id:'a23', jp:'å‡ºå£ã¯ã©ã¡ã‚‰ã§ã™ã‹ï¼Ÿ', casual:'Where\'s the exit?', polite:'Could you point me towards the exit, please?' },
    { id:'a24', jp:'ã‚¿ã‚¯ã‚·ãƒ¼ä¹—ã‚Šå ´ã¯ã©ã“ã§ã™ã‹ï¼Ÿ', casual:'Where do I get a taxi?', polite:'Could you direct me to the taxi rank, please?' },
    { id:'a25', jp:'å¸°ã‚Šã®ä¾¿ã‚’å¤‰æ›´ã—ãŸã„ã®ã§ã™ãŒ', casual:'I need to change my return flight.', polite:'I was wondering if I could change my return flight.' },
  ];

  const quiz = [
    { jp:'ã€Œçª“å´ã®å¸­ã‚’ãŠé¡˜ã„ã§ãã¾ã™ã‹ï¼Ÿã€ã‚’è‹±èªã§ï¼Ÿ', options:['Can I get a window seat?','I want window.','Give me a window seat.','Where is window seat?'], answer:0 },
    { jp:'ã€Œæ—…è¡Œã§æ¥ã¾ã—ãŸã€ã‚’è‹±èªã§ï¼Ÿ', options:['I came for travel.','I\'m here on holiday.','I travel here.','My purpose is travel.'], answer:1 },
    { jp:'ã€Œç”³å‘Šã™ã‚‹ã‚‚ã®ã¯ã‚ã‚Šã¾ã›ã‚“ã€ã‚’è‹±èªã§ï¼Ÿ', options:['I have no things.','No declaration.','Nothing to declare.','I don\'t have anything.'], answer:2 },
    { jp:'ã€Œã‚‚ã†ä¸€æšæ¯›å¸ƒã‚’ã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿã€ã‚’è‹±èªã§ï¼Ÿ', options:['Give me blanket.','I want more blanket.','One blanket more.','Can I get another blanket?'], answer:3 },
    { jp:'ã€Œé ã‘ãŸè·ç‰©ãŒå‡ºã¦ãã¾ã›ã‚“ã€ã‚’è‹±èªã§ï¼Ÿ', options:['My bag hasn\'t come out.','Bag is not here.','Where is my bag going?','I lost my bag inside.'], answer:0 },
  ];

  renderScenePage('airport', 'âœˆï¸', 'ç©ºæ¸¯ãƒ»æ©Ÿå†…', phrases, quiz);
})();

// ===== Restaurant Phrases =====
(function() {
  const phrases = [
    { id:'r01', jp:'2åã§äºˆç´„ã—ã¦ã„ã¾ã™', casual:'I have a reservation for two.', polite:'I have a reservation for two under the name ___.' },
    { id:'r02', jp:'äºˆç´„ã—ã¦ã„ãªã„ã®ã§ã™ãŒã€å…¥ã‚Œã¾ã™ã‹ï¼Ÿ', casual:'Do you have a table for two?', polite:'We don\'t have a reservation. Would you happen to have a table for two?' },
    { id:'r03', jp:'å¾…ã¡æ™‚é–“ã¯ã©ã®ãã‚‰ã„ã§ã™ã‹ï¼Ÿ', casual:'How long is the wait?', polite:'Could you tell me how long the wait would be?' },
    { id:'r04', jp:'ãƒ†ãƒ©ã‚¹å¸­ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ', casual:'Can we sit outside?', polite:'Would it be possible to sit on the terrace?' },
    { id:'r05', jp:'ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿ', casual:'Can I see the menu?', polite:'Could we have the menu, please?' },
    { id:'r06', jp:'ãŠã™ã™ã‚ã¯ä½•ã§ã™ã‹ï¼Ÿ', casual:'What do you recommend?', polite:'What would you recommend here?' },
    { id:'r07', jp:'ã“ã‚Œã¯ä½•ã®æ–™ç†ã§ã™ã‹ï¼Ÿ', casual:'What\'s this dish?', polite:'Could you tell me what this dish is?' },
    { id:'r08', jp:'ã“ã‚Œã‚’ãã ã•ã„', casual:'I\'ll have this one.', polite:'I\'d like this one, please.' },
    { id:'r09', jp:'åŒã˜ã‚‚ã®ã‚’ãŠé¡˜ã„ã—ã¾ã™', casual:'I\'ll have the same.', polite:'I\'d like the same, please.' },
    { id:'r10', jp:'ãƒŠãƒƒãƒ„ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ãŒã‚ã‚Šã¾ã™', casual:'I\'m allergic to nuts.', polite:'I have a nut allergy. Could you check if this contains nuts?' },
    { id:'r11', jp:'ãƒ™ã‚¸ã‚¿ãƒªã‚¢ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ', casual:'Do you have vegetarian options?', polite:'Would you happen to have any vegetarian options?' },
    { id:'r12', jp:'ã‚°ãƒ«ãƒ†ãƒ³ãƒ•ãƒªãƒ¼ã®ã‚‚ã®ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ', casual:'Anything gluten-free?', polite:'Do you have any gluten-free options available?' },
    { id:'r13', jp:'ãŠæ°´ã‚’ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿ', casual:'Can I get some water?', polite:'Could we have some water, please?' },
    { id:'r14', jp:'ã™ã¿ã¾ã›ã‚“ï¼ˆåº—å“¡ã‚’å‘¼ã¶ï¼‰', casual:'Excuse me!', polite:'Excuse me, when you have a moment.' },
    { id:'r15', jp:'ãŠä¼šè¨ˆã‚’ãŠé¡˜ã„ã—ã¾ã™', casual:'Can I get the check?', polite:'Could we have the bill, please?' },
    { id:'r16', jp:'ã‚«ãƒ¼ãƒ‰ã§æ‰•ãˆã¾ã™ã‹ï¼Ÿ', casual:'Do you take cards?', polite:'Is it possible to pay by card?' },
    { id:'r17', jp:'åˆ¥ã€…ã«æ‰•ãˆã¾ã™ã‹ï¼Ÿ', casual:'Can we split the bill?', polite:'Would it be possible to split the bill?' },
    { id:'r18', jp:'ã¨ã¦ã‚‚ç¾å‘³ã—ã‹ã£ãŸã§ã™', casual:'That was delicious!', polite:'The meal was absolutely wonderful, thank you.' },
    { id:'r19', jp:'é‡ãŒå¤šã™ãã¾ã™ã€‚æŒã¡å¸°ã‚Œã¾ã™ã‹ï¼Ÿ', casual:'This is too much. Can I get a takeaway box?', polite:'Could I possibly get a box to take the rest home?' },
    { id:'r20', jp:'è¾›ã•æ§ãˆã‚ã«ã§ãã¾ã™ã‹ï¼Ÿ', casual:'Can you make it less spicy?', polite:'Would it be possible to make it a bit less spicy?' },
    { id:'r21', jp:'ãƒ‡ã‚¶ãƒ¼ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ', casual:'Do you have a dessert menu?', polite:'Could we see the dessert menu, please?' },
    { id:'r22', jp:'ã‚³ãƒ¼ãƒ’ãƒ¼ã‚’ä¸€æ¯ãŠé¡˜ã„ã—ã¾ã™', casual:'A coffee, please.', polite:'Could I have a coffee, please?' },
    { id:'r23', jp:'ãƒãƒƒãƒ—ã¯å«ã¾ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ', casual:'Is the tip included?', polite:'Does the bill include a service charge?' },
    { id:'r24', jp:'å†™çœŸã‚’æ’®ã£ã¦ã‚‚ã„ã„ã§ã™ã‹ï¼Ÿï¼ˆæ–™ç†ã®ï¼‰', casual:'Mind if I take a photo?', polite:'Would it be alright if I took a photo of the food?' },
    { id:'r25', jp:'äºˆç´„ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ãŸã„ã®ã§ã™ãŒ', casual:'I need to cancel my reservation.', polite:'I\'m afraid I need to cancel my reservation.' },
  ];

  const quiz = [
    { jp:'ã€ŒãŠã™ã™ã‚ã¯ä½•ã§ã™ã‹ï¼Ÿã€ã‚’è‹±èªã§ï¼Ÿ', options:['What is good here?','What do you recommend?','Tell me the best.','Which is popular?'], answer:1 },
    { jp:'ã€ŒãŠä¼šè¨ˆã‚’ãŠé¡˜ã„ã—ã¾ã™ã€ã‚’è‹±èªã§ï¼Ÿ', options:['Money please.','I want to pay.','Can I get the check?','How much is it?'], answer:2 },
    { jp:'ã€ŒãƒŠãƒƒãƒ„ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ãŒã‚ã‚Šã¾ã™ã€ã‚’è‹±èªã§ï¼Ÿ', options:['I can\'t eat nuts.','Nuts are bad for me.','No nuts.','I\'m allergic to nuts.'], answer:3 },
    { jp:'ã€Œãƒ†ãƒ©ã‚¹å¸­ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿã€ã‚’è‹±èªã§ï¼Ÿ', options:['Can we sit outside?','Outside table?','I want terrace.','Is there outside?'], answer:0 },
    { jp:'ã€Œåˆ¥ã€…ã«æ‰•ãˆã¾ã™ã‹ï¼Ÿã€ã‚’è‹±èªã§ï¼Ÿ', options:['Each person pays.','Separate, please.','Can we split the bill?','Two bills please.'], answer:2 },
  ];

  renderScenePage('restaurant', 'ğŸ½ï¸', 'ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ãƒ»ã‚«ãƒ•ã‚§', phrases, quiz);
})();

// ===== Transport Phrases =====
(function() {
  const phrases = [
    { id:'t01', jp:'â—‹â—‹ã¾ã§ãŠé¡˜ã„ã—ã¾ã™', casual:'To ___, please.', polite:'Could you take me to ___, please?' },
    { id:'t02', jp:'ã ã„ãŸã„ã„ãã‚‰ã‹ã‹ã‚Šã¾ã™ã‹ï¼Ÿ', casual:'How much will it cost?', polite:'Could you give me a rough idea of the fare?' },
    { id:'t03', jp:'ã©ã®ãã‚‰ã„æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™ã‹ï¼Ÿ', casual:'How long will it take?', polite:'Could you tell me how long the journey will take?' },
    { id:'t04', jp:'ã“ã“ã§é™ã‚ã—ã¦ãã ã•ã„', casual:'You can drop me off here.', polite:'Could you drop me off here, please?' },
    { id:'t05', jp:'ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚’ä½¿ã£ã¦ã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿ', casual:'Can you use the meter?', polite:'Would you mind using the meter, please?' },
    { id:'t06', jp:'ãƒˆãƒ©ãƒ³ã‚¯ã‚’é–‹ã‘ã¦ã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿ', casual:'Can you pop the boot?', polite:'Could you open the boot for me, please?', note:'boot=ãƒˆãƒ©ãƒ³ã‚¯ï¼ˆè‹±ï¼‰/ trunkï¼ˆç±³ï¼‰' },
    { id:'t07', jp:'ã“ã®é›»è»Šã¯â—‹â—‹ã«è¡Œãã¾ã™ã‹ï¼Ÿ', casual:'Does this train go to ___?', polite:'Excuse me, does this train stop at ___?' },
    { id:'t08', jp:'æ¬¡ã®é§…ã¯ã©ã“ã§ã™ã‹ï¼Ÿ', casual:'What\'s the next stop?', polite:'Could you tell me what the next stop is?' },
    { id:'t09', jp:'ä¹—ã‚Šæ›ãˆãŒå¿…è¦ã§ã™ã‹ï¼Ÿ', casual:'Do I need to transfer?', polite:'Will I need to change trains at any point?' },
    { id:'t10', jp:'ä¸€æ—¥ä¹—è»Šåˆ¸ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ', casual:'Do you have a day pass?', polite:'Is there a day pass available?' },
    { id:'t11', jp:'ç‰‡é“åˆ‡ç¬¦ã‚’ãã ã•ã„', casual:'A one-way ticket, please.', polite:'Could I have a single ticket to ___, please?' },
    { id:'t12', jp:'å¾€å¾©åˆ‡ç¬¦ã‚’ãã ã•ã„', casual:'A return ticket, please.', polite:'Could I have a return ticket to ___, please?' },
    { id:'t13', jp:'â—‹â—‹ã¸ã®è¡Œãæ–¹ã‚’æ•™ãˆã¦ã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿ', casual:'How do I get to ___?', polite:'Could you tell me the best way to get to ___?' },
    { id:'t14', jp:'æ­©ã„ã¦è¡Œã‘ã‚‹è·é›¢ã§ã™ã‹ï¼Ÿ', casual:'Can I walk there?', polite:'Is it within walking distance?' },
    { id:'t15', jp:'ãƒã‚¹åœã¯ã©ã“ã§ã™ã‹ï¼Ÿ', casual:'Where\'s the bus stop?', polite:'Could you point me to the nearest bus stop?' },
    { id:'t16', jp:'ã“ã®ãƒã‚¹ã¯â—‹â—‹ã‚’é€šã‚Šã¾ã™ã‹ï¼Ÿ', casual:'Does this bus go past ___?', polite:'Excuse me, does this bus go via ___?' },
    { id:'t17', jp:'é™ã‚Šã‚‹ã¨ã“ã‚ã‚’æ•™ãˆã¦ã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿ', casual:'Can you tell me when to get off?', polite:'Would you mind letting me know when we reach ___?' },
    { id:'t18', jp:'Uberã‚’å‘¼ã³ãŸã„ã®ã§ã™ãŒ', casual:'I\'m going to call an Uber.', polite:'I\'d like to arrange an Uber, if possible.' },
    { id:'t19', jp:'ãƒ¬ãƒ³ã‚¿ã‚«ãƒ¼ã‚’å€Ÿã‚ŠãŸã„ã®ã§ã™ãŒ', casual:'I want to rent a car.', polite:'I\'d like to hire a car, please.' },
    { id:'t20', jp:'ãƒŠãƒ“ä»˜ãã®è»Šã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ', casual:'Do you have one with GPS?', polite:'Do you have a car with GPS navigation available?' },
    { id:'t21', jp:'ã¾ã£ã™ãè¡Œã£ã¦ãã ã•ã„', casual:'Go straight.', polite:'Straight ahead, please.' },
    { id:'t22', jp:'æ¬¡ã®è§’ã‚’å³ã«æ›²ãŒã£ã¦ãã ã•ã„', casual:'Turn right at the next corner.', polite:'Could you turn right at the next corner, please?' },
    { id:'t23', jp:'ã“ã“ã¯é§è»Šã§ãã¾ã™ã‹ï¼Ÿ', casual:'Can I park here?', polite:'Is it alright to park here?' },
    { id:'t24', jp:'æœ€çµ‚é›»è»Šã¯ä½•æ™‚ã§ã™ã‹ï¼Ÿ', casual:'When\'s the last train?', polite:'Could you tell me when the last train departs?' },
    { id:'t25', jp:'é ˜åæ›¸ã‚’ã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿ', casual:'Can I get a receipt?', polite:'Could I have a receipt, please?' },
  ];
  const quiz = [
    { jp:'ã€Œâ—‹â—‹ã¾ã§ãŠé¡˜ã„ã—ã¾ã™ã€ã‚’è‹±èªã§ï¼Ÿ', options:['To ___, please.','Bring me to ___.','I go ___.','Take ___.'], answer:0 },
    { jp:'ã€Œä¹—ã‚Šæ›ãˆãŒå¿…è¦ã§ã™ã‹ï¼Ÿã€ã‚’è‹±èªã§ï¼Ÿ', options:['Must I change?','Do I need to transfer?','Is there a switch?','Should I move trains?'], answer:1 },
    { jp:'ã€Œæ­©ã„ã¦è¡Œã‘ã‚‹è·é›¢ã§ã™ã‹ï¼Ÿã€ã‚’è‹±èªã§ï¼Ÿ', options:['Can I walk?','Is it far by foot?','Can I walk there?','Is walking OK?'], answer:2 },
    { jp:'ã€Œé ˜åæ›¸ã‚’ã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿã€ã‚’è‹±èªã§ï¼Ÿ', options:['Receipt, please.','I need paper.','Give me receipt.','Can I get a receipt?'], answer:3 },
    { jp:'ã€Œæœ€çµ‚é›»è»Šã¯ä½•æ™‚ã§ã™ã‹ï¼Ÿã€ã‚’è‹±èªã§ï¼Ÿ', options:['When\'s the last train?','Last train time?','What time train finishes?','Is there a late train?'], answer:0 },
  ];
  renderScenePage('transport', 'ğŸš•', 'ç§»å‹•ãƒ»äº¤é€š', phrases, quiz);
})();

// ===== Hotel Phrases =====
(function() {
  const phrases = [
    { id:'ht01', jp:'ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ã‚’ãŠé¡˜ã„ã—ã¾ã™', casual:'I\'d like to check in.', polite:'I\'d like to check in, please. The reservation is under ___.' },
    { id:'ht02', jp:'äºˆç´„ã‚’ç¢ºèªã—ã¦ã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿ', casual:'Can you look up my booking?', polite:'Could you check my reservation, please?' },
    { id:'ht03', jp:'ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã¯ä½•æ™‚ã§ã™ã‹ï¼Ÿ', casual:'What time is checkout?', polite:'Could you tell me what time checkout is?' },
    { id:'ht04', jp:'ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã‚’é…ãã§ãã¾ã™ã‹ï¼Ÿ', casual:'Can I get a late checkout?', polite:'Would it be possible to have a late checkout?' },
    { id:'ht05', jp:'è·ç‰©ã‚’é ã‹ã£ã¦ã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿ', casual:'Can you hold my bags?', polite:'Could I leave my luggage here until later?' },
    { id:'ht06', jp:'éƒ¨å±‹ã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã§ãã¾ã™ã‹ï¼Ÿ', casual:'Any chance of an upgrade?', polite:'Would there be any possibility of a room upgrade?' },
    { id:'ht07', jp:'é«˜å±¤éšã®éƒ¨å±‹ãŒã„ã„ã®ã§ã™ãŒ', casual:'Can I get a higher floor?', polite:'Would it be possible to have a room on a higher floor?' },
    { id:'ht08', jp:'é™ã‹ãªéƒ¨å±‹ã‚’ãŠé¡˜ã„ã—ã¾ã™', casual:'I\'d like a quiet room.', polite:'Could I have a quiet room, if possible?' },
    { id:'ht09', jp:'ã‚¿ã‚ªãƒ«ã‚’è¿½åŠ ã§ã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿ', casual:'Can I get extra towels?', polite:'Could I have some extra towels sent to my room?' },
    { id:'ht10', jp:'ã‚¨ã‚¢ã‚³ãƒ³ãŒåŠ¹ãã¾ã›ã‚“', casual:'The AC isn\'t working.', polite:'I\'m afraid the air conditioning doesn\'t seem to be working.' },
    { id:'ht11', jp:'ãŠæ¹¯ãŒå‡ºã¾ã›ã‚“', casual:'There\'s no hot water.', polite:'I\'m sorry to bother you, but there doesn\'t seem to be any hot water.' },
    { id:'ht12', jp:'éµãŒé–‹ãã¾ã›ã‚“', casual:'My key isn\'t working.', polite:'I\'m having trouble with my room key â€” it doesn\'t seem to work.' },
    { id:'ht13', jp:'Wi-Fiã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æ•™ãˆã¦ãã ã•ã„', casual:'What\'s the Wi-Fi password?', polite:'Could you tell me the Wi-Fi password, please?' },
    { id:'ht14', jp:'ãƒ¢ãƒ¼ãƒ‹ãƒ³ã‚°ã‚³ãƒ¼ãƒ«ã‚’ãŠé¡˜ã„ã—ã¾ã™', casual:'Can I get a wake-up call at 7?', polite:'Could I arrange a wake-up call for 7 a.m., please?' },
    { id:'ht15', jp:'æœé£Ÿã¯ä½•æ™‚ã‹ã‚‰ã§ã™ã‹ï¼Ÿ', casual:'When does breakfast start?', polite:'Could you tell me what time breakfast is served?' },
    { id:'ht16', jp:'è¿‘ãã«ãŠã™ã™ã‚ã®ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ', casual:'Any good restaurants nearby?', polite:'Could you recommend a restaurant in the area?' },
    { id:'ht17', jp:'ã‚¿ã‚¯ã‚·ãƒ¼ã‚’å‘¼ã‚“ã§ã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿ', casual:'Can you call me a taxi?', polite:'Would you be able to arrange a taxi for me?' },
    { id:'ht18', jp:'ã“ã®å‘¨è¾ºã®åœ°å›³ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ', casual:'Do you have a map of the area?', polite:'Would you happen to have a map of the surrounding area?' },
    { id:'ht19', jp:'ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ', casual:'Do you have laundry service?', polite:'Is there a laundry service available?' },
    { id:'ht20', jp:'éƒ¨å±‹ã«é‡‘åº«ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ', casual:'Is there a safe in the room?', polite:'Does the room have an in-room safe?' },
    { id:'ht21', jp:'ã‚³ãƒ³ã‚»ãƒ³ãƒˆã®å¤‰æ›ãƒ—ãƒ©ã‚°ã‚’å€Ÿã‚Šã‚‰ã‚Œã¾ã™ã‹ï¼Ÿ', casual:'Can I borrow a plug adapter?', polite:'Would it be possible to borrow a power adapter?' },
    { id:'ht22', jp:'éš£ã®éƒ¨å±‹ãŒã†ã‚‹ã•ã„ã®ã§ã™ãŒ', casual:'The room next door is really noisy.', polite:'I\'m sorry to trouble you, but there\'s quite a bit of noise coming from the next room.' },
    { id:'ht23', jp:'éƒ¨å±‹ã‚’å¤‰ãˆã¦ã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿ', casual:'Can I switch rooms?', polite:'Would it be possible to move to a different room?' },
    { id:'ht24', jp:'ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆãŠé¡˜ã„ã—ã¾ã™', casual:'I\'m checking out.', polite:'I\'d like to check out, please.' },
    { id:'ht25', jp:'ãƒŸãƒ‹ãƒãƒ¼ã¯ä½¿ã£ã¦ã„ã¾ã›ã‚“', casual:'I didn\'t use the minibar.', polite:'I haven\'t used anything from the minibar.' },
  ];
  const quiz = [
    { jp:'ã€Œãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã‚’é…ãã§ãã¾ã™ã‹ï¼Ÿã€ã‚’è‹±èªã§ï¼Ÿ', options:['Late checkout?','Can I get a late checkout?','Checkout later OK?','I want late checkout.'], answer:1 },
    { jp:'ã€ŒãŠæ¹¯ãŒå‡ºã¾ã›ã‚“ã€ã‚’è‹±èªã§ï¼Ÿ', options:['Water is cold.','Hot water broken.','There\'s no hot water.','No warm water comes.'], answer:2 },
    { jp:'ã€ŒWi-Fiã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æ•™ãˆã¦ãã ã•ã„ã€ã‚’è‹±èªã§ï¼Ÿ', options:['Wi-Fi key?','Tell me Wi-Fi.','Internet password?','What\'s the Wi-Fi password?'], answer:3 },
    { jp:'ã€Œã‚¿ã‚¯ã‚·ãƒ¼ã‚’å‘¼ã‚“ã§ã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿã€ã‚’è‹±èªã§ï¼Ÿ', options:['Can you call me a taxi?','I want taxi.','Taxi here please.','Order me a taxi.'], answer:0 },
    { jp:'ã€Œè·ç‰©ã‚’é ã‹ã£ã¦ã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿã€ã‚’è‹±èªã§ï¼Ÿ', options:['Keep my bag.','Can you hold my bags?','Watch my luggage.','Bags stay here?'], answer:1 },
  ];
  renderScenePage('hotel', 'ğŸ¨', 'ãƒ›ãƒ†ãƒ«', phrases, quiz);
})();

// ===== Shopping Phrases =====
(function() {
  const phrases = [
    { id:'s01', jp:'è¦‹ã¦ã„ã‚‹ã ã‘ã§ã™', casual:'Just looking, thanks.', polite:'I\'m just browsing, thank you.' },
    { id:'s02', jp:'ã“ã‚Œã¯ã„ãã‚‰ã§ã™ã‹ï¼Ÿ', casual:'How much is this?', polite:'Could you tell me the price of this?' },
    { id:'s03', jp:'è©¦ç€ã—ã¦ã‚‚ã„ã„ã§ã™ã‹ï¼Ÿ', casual:'Can I try this on?', polite:'Would it be alright if I tried this on?' },
    { id:'s04', jp:'ã‚‚ã†å°‘ã—å°ã•ã„ã‚µã‚¤ã‚ºã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ', casual:'Do you have this in a smaller size?', polite:'Would you happen to have this in a smaller size?' },
    { id:'s05', jp:'ä»–ã®è‰²ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ', casual:'Do you have this in a different colour?', polite:'Does this come in any other colours?' },
    { id:'s06', jp:'å°‘ã—å¤§ãã„ã§ã™', casual:'It\'s a bit too big.', polite:'I\'m afraid this is a little too large for me.' },
    { id:'s07', jp:'ã´ã£ãŸã‚Šã§ã™ï¼', casual:'It fits perfectly!', polite:'This fits wonderfully!' },
    { id:'s08', jp:'ã“ã‚Œã‚’ãã ã•ã„', casual:'I\'ll take this.', polite:'I\'d like to purchase this, please.' },
    { id:'s09', jp:'ã‚®ãƒ•ãƒˆåŒ…è£…ã—ã¦ã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿ', casual:'Can you gift-wrap it?', polite:'Would it be possible to have this gift-wrapped?' },
    { id:'s10', jp:'å‰²å¼•ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ', casual:'Is there a discount?', polite:'Would there be any discount available?' },
    { id:'s11', jp:'å…ç¨æ‰‹ç¶šãã¯ã§ãã¾ã™ã‹ï¼Ÿ', casual:'Can I get tax-free?', polite:'Is tax-free shopping available here?' },
    { id:'s12', jp:'æ—¥æœ¬ã«ç™ºé€ã§ãã¾ã™ã‹ï¼Ÿ', casual:'Can you ship to Japan?', polite:'Would it be possible to have this shipped to Japan?' },
    { id:'s13', jp:'è¿”å“ãƒ»äº¤æ›ã¯ã§ãã¾ã™ã‹ï¼Ÿ', casual:'Can I return or exchange this?', polite:'What is your return and exchange policy?' },
    { id:'s14', jp:'ãŠåœŸç”£ã‚’æ¢ã—ã¦ã„ã¾ã™', casual:'I\'m looking for souvenirs.', polite:'I\'m looking for some souvenirs. Could you suggest anything?' },
    { id:'s15', jp:'äºˆç®—ã¯â—‹â—‹ãƒ‰ãƒ«ãã‚‰ã„ã§ã™', casual:'My budget is around ___ dollars.', polite:'I\'m looking for something around ___ dollars.' },
    { id:'s16', jp:'ãŠã™ã™ã‚ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ', casual:'What do you recommend?', polite:'Would you have any recommendations?' },
    { id:'s17', jp:'è€ƒãˆã¦ã‚‚ã„ã„ã§ã™ã‹ï¼Ÿ', casual:'Let me think about it.', polite:'Could I have a moment to think it over?' },
    { id:'s18', jp:'è¢‹ã¯ã„ã‚Šã¾ã›ã‚“', casual:'No bag, thanks.', polite:'I don\'t need a bag, thank you.' },
    { id:'s19', jp:'ãƒ¬ã‚·ãƒ¼ãƒˆã‚’ã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿ', casual:'Can I get a receipt?', polite:'Could I have a receipt, please?' },
    { id:'s20', jp:'ã“ã‚Œã¯å£Šã‚Œã¦ã„ã¾ã™ï¼æ±šã‚Œã¦ã„ã¾ã™', casual:'This one\'s damaged.', polite:'I\'m afraid this one appears to have some damage.' },
  ];
  const quiz = [
    { jp:'ã€Œè¦‹ã¦ã„ã‚‹ã ã‘ã§ã™ã€ã‚’è‹±èªã§ï¼Ÿ', options:['Just looking, thanks.','I don\'t buy.','Only watching.','I see things.'], answer:0 },
    { jp:'ã€Œè©¦ç€ã—ã¦ã‚‚ã„ã„ã§ã™ã‹ï¼Ÿã€ã‚’è‹±èªã§ï¼Ÿ', options:['I wear this?','Let me try.','Can I try this on?','Fitting room?'], answer:2 },
    { jp:'ã€Œå…ç¨æ‰‹ç¶šãã¯ã§ãã¾ã™ã‹ï¼Ÿã€ã‚’è‹±èªã§ï¼Ÿ', options:['Tax return?','No tax please.','Can I get tax-free?','Remove the tax.'], answer:2 },
    { jp:'ã€Œã‚®ãƒ•ãƒˆåŒ…è£…ã—ã¦ã‚‚ã‚‰ãˆã¾ã™ã‹ï¼Ÿã€ã‚’è‹±èªã§ï¼Ÿ', options:['Wrap it nice.','Make it gift.','Present style please.','Can you gift-wrap it?'], answer:3 },
    { jp:'ã€Œä»–ã®è‰²ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿã€ã‚’è‹±èªã§ï¼Ÿ', options:['Do you have this in a different colour?','Other colour?','Change colour please.','More colours?'], answer:0 },
  ];
  renderScenePage('shopping', 'ğŸ›ï¸', 'ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°', phrases, quiz);
})();

// ===== Sightseeing Phrases =====
(function() {
  const phrases = [
    { id:'ss01', jp:'å¤§äºº2æšãã ã•ã„', casual:'Two adults, please.', polite:'Could I have two adult tickets, please?' },
    { id:'ss02', jp:'å­¦ç”Ÿå‰²å¼•ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ', casual:'Is there a student discount?', polite:'Do you offer a student discount by any chance?' },
    { id:'ss03', jp:'å†™çœŸã‚’æ’®ã£ã¦ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿ', casual:'Could you take our photo?', polite:'Would you mind taking a photo of us, please?' },
    { id:'ss04', jp:'ã“ã“ã§å†™çœŸã‚’æ’®ã£ã¦ã‚‚ã„ã„ã§ã™ã‹ï¼Ÿ', casual:'Can I take photos here?', polite:'Is photography allowed here?' },
    { id:'ss05', jp:'ãŠã™ã™ã‚ã®è¦³å…‰ã‚¹ãƒãƒƒãƒˆã¯ã©ã“ã§ã™ã‹ï¼Ÿ', casual:'What are the must-sees around here?', polite:'Could you recommend some must-see attractions in the area?' },
    { id:'ss06', jp:'ã‚¬ã‚¤ãƒ‰ãƒ„ã‚¢ãƒ¼ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ', casual:'Do you have guided tours?', polite:'Are there any guided tours available?' },
    { id:'ss07', jp:'è‹±èªã®ã‚¬ã‚¤ãƒ‰ã¯ã„ã¾ã™ã‹ï¼Ÿ', casual:'Is there an English guide?', polite:'Is there a tour available in English?' },
    { id:'ss08', jp:'ãƒ„ã‚¢ãƒ¼ã¯ã©ã®ãã‚‰ã„ã‹ã‹ã‚Šã¾ã™ã‹ï¼Ÿ', casual:'How long is the tour?', polite:'Could you tell me how long the tour takes?' },
    { id:'ss09', jp:'ã“ã®å»ºç‰©ã¯ã„ã¤å»ºã¦ã‚‰ã‚ŒãŸã®ã§ã™ã‹ï¼Ÿ', casual:'When was this built?', polite:'Do you know when this building was constructed?' },
    { id:'ss10', jp:'é–‰é¤¨æ™‚é–“ã¯ä½•æ™‚ã§ã™ã‹ï¼Ÿ', casual:'What time do you close?', polite:'Could you tell me what time you close?' },
    { id:'ss11', jp:'ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã‚¬ã‚¤ãƒ‰ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ', casual:'Do you have audio guides?', polite:'Is there an audio guide available, by any chance?' },
    { id:'ss12', jp:'æ—¥æœ¬èªã®ãƒ‘ãƒ³ãƒ•ãƒ¬ãƒƒãƒˆã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ', casual:'Do you have a Japanese brochure?', polite:'Would you happen to have a brochure in Japanese?' },
    { id:'ss13', jp:'ã“ã“ã‹ã‚‰â—‹â—‹ã¾ã§æ­©ã‘ã¾ã™ã‹ï¼Ÿ', casual:'Can I walk to ___ from here?', polite:'Is ___ within walking distance from here?' },
    { id:'ss14', jp:'ä¸€ç•ªã®è¦‹ã©ã“ã‚ã¯ä½•ã§ã™ã‹ï¼Ÿ', casual:'What\'s the highlight?', polite:'What would you say is the main highlight here?' },
    { id:'ss15', jp:'è·ç‰©ã‚’é ã‘ã‚‹ã¨ã“ã‚ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ', casual:'Is there a locker?', polite:'Is there a cloakroom or locker available?' },
    { id:'ss16', jp:'ã“ã“ã¯äºˆç´„ãŒå¿…è¦ã§ã™ã‹ï¼Ÿ', casual:'Do I need to book in advance?', polite:'Is advance booking required for this?' },
    { id:'ss17', jp:'Wi-Fiã‚¹ãƒãƒƒãƒˆã¯ã©ã“ã§ã™ã‹ï¼Ÿ', casual:'Where can I get Wi-Fi?', polite:'Is there a Wi-Fi hotspot nearby?' },
    { id:'ss18', jp:'ã“ã®è¿‘ãã«ã‚«ãƒ•ã‚§ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ', casual:'Any cafes nearby?', polite:'Could you recommend a cafe near here?' },
    { id:'ss19', jp:'ãƒã‚±ãƒƒãƒˆã¯ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã§è²·ãˆã¾ã™ã‹ï¼Ÿ', casual:'Can I buy tickets online?', polite:'Is it possible to purchase tickets online?' },
    { id:'ss20', jp:'å¤œæ™¯ãŒãã‚Œã„ãªå ´æ‰€ã¯ã©ã“ã§ã™ã‹ï¼Ÿ', casual:'Where\'s a good spot for the night view?', polite:'Could you recommend a place with a beautiful night view?' },
  ];
  const quiz = [
    { jp:'ã€Œå†™çœŸã‚’æ’®ã£ã¦ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿã€ã‚’è‹±èªã§ï¼Ÿ', options:['Take my photo.','Photo please.','Could you take our photo?','Shoot us.'], answer:2 },
    { jp:'ã€ŒãŠã™ã™ã‚ã®è¦³å…‰ã‚¹ãƒãƒƒãƒˆã¯ï¼Ÿã€ã‚’è‹±èªã§ï¼Ÿ', options:['Good places?','What are the must-sees around here?','Where should I go?','Tell me sights.'], answer:1 },
    { jp:'ã€Œé–‰é¤¨æ™‚é–“ã¯ä½•æ™‚ã§ã™ã‹ï¼Ÿã€ã‚’è‹±èªã§ï¼Ÿ', options:['When closed?','What time do you close?','Closing hour?','When do you finish?'], answer:1 },
    { jp:'ã€Œå¤§äºº2æšãã ã•ã„ã€ã‚’è‹±èªã§ï¼Ÿ', options:['Two adults, please.','Give me two.','Two people ticket.','Adult two tickets.'], answer:0 },
    { jp:'ã€Œã‚¬ã‚¤ãƒ‰ãƒ„ã‚¢ãƒ¼ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿã€ã‚’è‹±èªã§ï¼Ÿ', options:['Tour guide here?','Can I get a guide?','Do you have guided tours?','Is there touring?'], answer:2 },
  ];
  renderScenePage('sightseeing', 'ğŸ“¸', 'è¦³å…‰ãƒ»ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£', phrases, quiz);
})();

// ===== Trouble Phrases =====
(function() {
  const phrases = [
    { id:'tr01', jp:'é“ã«è¿·ã„ã¾ã—ãŸ', casual:'I\'m lost.', polite:'I\'m afraid I\'ve lost my way.' },
    { id:'tr02', jp:'è²¡å¸ƒã‚’ãªãã—ã¾ã—ãŸ', casual:'I lost my wallet.', polite:'I\'m afraid I\'ve lost my wallet.' },
    { id:'tr03', jp:'ãƒ‘ã‚¹ãƒãƒ¼ãƒˆã‚’ç›—ã¾ã‚Œã¾ã—ãŸ', casual:'My passport was stolen.', polite:'I need to report that my passport has been stolen.' },
    { id:'tr04', jp:'è­¦å¯Ÿã‚’å‘¼ã‚“ã§ãã ã•ã„', casual:'Call the police!', polite:'Could you please call the police?' },
    { id:'tr05', jp:'æ•‘æ€¥è»Šã‚’å‘¼ã‚“ã§ãã ã•ã„', casual:'Call an ambulance!', polite:'We need an ambulance, please.' },
    { id:'tr06', jp:'å…·åˆãŒæ‚ªã„ã§ã™', casual:'I don\'t feel well.', polite:'I\'m feeling rather unwell.' },
    { id:'tr07', jp:'é ­ãŒç—›ã„ã§ã™', casual:'I have a headache.', polite:'I\'ve got quite a bad headache.' },
    { id:'tr08', jp:'ãŠè…¹ãŒç—›ã„ã§ã™', casual:'My stomach hurts.', polite:'I\'m having some stomach pain.' },
    { id:'tr09', jp:'è–¬å±€ã¯ã©ã“ã§ã™ã‹ï¼Ÿ', casual:'Where\'s the pharmacy?', polite:'Could you direct me to the nearest pharmacy?' },
    { id:'tr10', jp:'ç—…é™¢ã«è¡ŒããŸã„ã®ã§ã™ãŒ', casual:'I need to see a doctor.', polite:'I need to go to a hospital. Could you help me?' },
    { id:'tr11', jp:'ã“ã®è–¬ã«ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ãŒã‚ã‚Šã¾ã™', casual:'I\'m allergic to this medicine.', polite:'I have an allergy to this medication.' },
    { id:'tr12', jp:'ä¿é™ºè¨¼ã‚’è¦‹ã›ã¾ã™', casual:'Here\'s my insurance card.', polite:'Here is my travel insurance information.' },
    { id:'tr13', jp:'æ—¥æœ¬å¤§ä½¿é¤¨ã«é€£çµ¡ã—ãŸã„ã®ã§ã™ãŒ', casual:'I need to contact the Japanese embassy.', polite:'Could you help me contact the Japanese embassy?' },
    { id:'tr14', jp:'æºå¸¯ã‚’ã©ã“ã‹ã«ç½®ãå¿˜ã‚Œã¾ã—ãŸ', casual:'I left my phone somewhere.', polite:'I believe I\'ve left my phone somewhere.' },
    { id:'tr15', jp:'éºå¤±ç‰©å–æ‰±æ‰€ã¯ã©ã“ã§ã™ã‹ï¼Ÿ', casual:'Where\'s the lost and found?', polite:'Could you tell me where the lost property office is?' },
    { id:'tr16', jp:'ãƒ›ãƒ†ãƒ«ã®ä½æ‰€ãŒã‚ã‹ã‚Šã¾ã›ã‚“', casual:'I don\'t know my hotel address.', polite:'I\'m afraid I can\'t remember my hotel address.' },
    { id:'tr17', jp:'ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ã‚’æ­¢ã‚ãŸã„ã®ã§ã™ãŒ', casual:'I need to cancel my credit card.', polite:'I need to report my credit card as lost and have it cancelled.' },
    { id:'tr18', jp:'åŠ©ã‘ã¦ãã ã•ã„ï¼', casual:'Help!', polite:'Please, I need help!' },
    { id:'tr19', jp:'è‹±èªãŒè©±ã›ã‚‹åŒ»è€…ã¯ã„ã¾ã™ã‹ï¼Ÿ', casual:'Is there a doctor who speaks English?', polite:'Would there be an English-speaking doctor available?' },
    { id:'tr20', jp:'è¢«å®³å±Šã‚’å‡ºã—ãŸã„ã®ã§ã™ãŒ', casual:'I want to file a report.', polite:'I\'d like to file a police report, please.' },
  ];
  const quiz = [
    { jp:'ã€Œè²¡å¸ƒã‚’ãªãã—ã¾ã—ãŸã€ã‚’è‹±èªã§ï¼Ÿ', options:['My wallet is gone.','I lost my wallet.','Wallet disappeared.','No more wallet.'], answer:1 },
    { jp:'ã€Œå…·åˆãŒæ‚ªã„ã§ã™ã€ã‚’è‹±èªã§ï¼Ÿ', options:['I\'m sick feeling.','Bad condition.','I don\'t feel well.','Health is bad.'], answer:2 },
    { jp:'ã€Œè–¬å±€ã¯ã©ã“ã§ã™ã‹ï¼Ÿã€ã‚’è‹±èªã§ï¼Ÿ', options:['Medicine shop?','Drug place?','Where\'s medicine?','Where\'s the pharmacy?'], answer:3 },
    { jp:'ã€Œéºå¤±ç‰©å–æ‰±æ‰€ã¯ã©ã“ã§ã™ã‹ï¼Ÿã€ã‚’è‹±èªã§ï¼Ÿ', options:['Where\'s the lost and found?','Lost things office?','Missing items?','Where do I find lost?'], answer:0 },
    { jp:'ã€ŒåŠ©ã‘ã¦ãã ã•ã„ï¼ã€ã‚’è‹±èªã§ï¼Ÿ', options:['Save me!','Help!','Please assist!','I need saving!'], answer:1 },
  ];
  renderScenePage('trouble', 'ğŸš¨', 'ãƒˆãƒ©ãƒ–ãƒ«ãƒ»ç·Šæ€¥', phrases, quiz);
})();

// ===== Small Talk Phrases =====
(function() {
  const phrases = [
    { id:'st01', jp:'ã„ã„å¤©æ°—ã§ã™ã­', casual:'Nice weather, isn\'t it?', polite:'What lovely weather we\'re having.' },
    { id:'st02', jp:'ã©ã¡ã‚‰ã‹ã‚‰æ¥ãŸã®ã§ã™ã‹ï¼Ÿ', casual:'Where are you from?', polite:'May I ask where you\'re from?' },
    { id:'st03', jp:'æ—¥æœ¬ã‹ã‚‰æ¥ã¾ã—ãŸ', casual:'I\'m from Japan.', polite:'I\'m from Japan, from a city called ___.' },
    { id:'st04', jp:'ã“ã“ã¯åˆã‚ã¦ã§ã™ã‹ï¼Ÿ', casual:'Is this your first time here?', polite:'Is this your first visit to this area?' },
    { id:'st05', jp:'ã“ã“ã¯åˆã‚ã¦ã§ã™', casual:'It\'s my first time here.', polite:'This is my first time visiting, actually.' },
    { id:'st06', jp:'ã“ã®è¡—ãŒæ°—ã«å…¥ã‚Šã¾ã—ãŸ', casual:'I love this city!', polite:'I\'m really enjoying this city.' },
    { id:'st07', jp:'ã“ã®è¾ºã‚Šã§ãŠã™ã™ã‚ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ', casual:'Any tips for around here?', polite:'Would you have any recommendations for things to do around here?' },
    { id:'st08', jp:'ãŠä»•äº‹ã¯ä½•ã‚’ã•ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ', casual:'What do you do?', polite:'What do you do for a living, if you don\'t mind my asking?' },
    { id:'st09', jp:'ç´ æ•µãªæœã§ã™ã­', casual:'I love your outfit!', polite:'What a lovely outfit you\'re wearing.' },
    { id:'st10', jp:'ãã‚Œã€ã„ã„ã§ã™ã­ï¼', casual:'That\'s cool!', polite:'That\'s really wonderful.' },
    { id:'st11', jp:'æ¥½ã—ã‚“ã§ã¾ã™ã‹ï¼Ÿ', casual:'Having a good time?', polite:'Are you enjoying yourself?' },
    { id:'st12', jp:'æ—…è¡Œã¯æ¥½ã—ã‚“ã§ã„ã¾ã™', casual:'I\'m having a great trip!', polite:'I\'m having a wonderful time on this trip.' },
    { id:'st13', jp:'å†™çœŸã‚’ä¸€ç·’ã«æ’®ã£ã¦ã‚‚ã„ã„ã§ã™ã‹ï¼Ÿ', casual:'Can we take a photo together?', polite:'Would you mind if we took a photo together?' },
    { id:'st14', jp:'é€£çµ¡å…ˆã‚’äº¤æ›ã—ã¾ã›ã‚“ã‹ï¼Ÿ', casual:'Wanna exchange contacts?', polite:'Would you like to exchange contact details?' },
    { id:'st15', jp:'SNSã‚„ã£ã¦ã¾ã™ã‹ï¼Ÿ', casual:'Are you on Instagram?', polite:'Do you use social media, by any chance?' },
    { id:'st16', jp:'ã¾ãŸä¼šãˆã‚‹ã¨ã„ã„ã§ã™ã­', casual:'Hope to see you again!', polite:'It would be lovely to see you again sometime.' },
    { id:'st17', jp:'ãŠä¼šã„ã§ãã¦ã‚ˆã‹ã£ãŸã§ã™', casual:'It was nice meeting you!', polite:'It\'s been a real pleasure meeting you.' },
    { id:'st18', jp:'è‰¯ã„æ—…ã‚’ï¼', casual:'Have a great trip!', polite:'I hope you have a wonderful journey.' },
    { id:'st19', jp:'æ°—ã‚’ã¤ã‘ã¦ï¼', casual:'Take care!', polite:'Do take care of yourself.' },
    { id:'st20', jp:'æ—¥æœ¬ã«æ¥ã‚‹ã“ã¨ãŒã‚ã‚Œã°ãœã²é€£çµ¡ã—ã¦ãã ã•ã„', casual:'Hit me up if you\'re ever in Japan!', polite:'If you ever visit Japan, please don\'t hesitate to get in touch.' },
  ];
  const quiz = [
    { jp:'ã€Œã©ã¡ã‚‰ã‹ã‚‰æ¥ãŸã®ã§ã™ã‹ï¼Ÿã€ã‚’è‹±èªã§ï¼Ÿ', options:['Your country?','Where are you from?','Where do you live?','Which country?'], answer:1 },
    { jp:'ã€Œã“ã®è¡—ãŒæ°—ã«å…¥ã‚Šã¾ã—ãŸã€ã‚’è‹±èªã§ï¼Ÿ', options:['Good city.','City is nice.','I love this city!','This town is fine.'], answer:2 },
    { jp:'ã€ŒãŠä¼šã„ã§ãã¦ã‚ˆã‹ã£ãŸã§ã™ã€ã‚’è‹±èªã§ï¼Ÿ', options:['Good to see you.','Nice meeting.','Happy we met.','It was nice meeting you!'], answer:3 },
    { jp:'ã€Œè‰¯ã„æ—…ã‚’ï¼ã€ã‚’è‹±èªã§ï¼Ÿ', options:['Have a great trip!','Good travel!','Trip well!','Travel safely!'], answer:0 },
    { jp:'ã€ŒãŠã™ã™ã‚ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿã€ã‚’è‹±èªã§ï¼Ÿ', options:['What\'s good?','Any tips for around here?','Recommend me.','Best things?'], answer:1 },
  ];
  renderScenePage('smalltalk', 'ğŸ’¬', 'ã‚¹ãƒ¢ãƒ¼ãƒ«ãƒˆãƒ¼ã‚¯', phrases, quiz);
})();

// ===== Claude API Helper =====
let claudeApiKey = storageGet('apiKey', '');

async function callClaude(systemPrompt, userMessage) {
  if (!claudeApiKey) throw new Error('APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
  const res = await fetch('https://api.anthropic.com/v1/messages', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'x-api-key': claudeApiKey,
      'anthropic-version': '2023-06-01',
      'anthropic-dangerous-direct-browser-access': 'true'
    },
    body: JSON.stringify({
      model: 'claude-sonnet-4-20250514',
      max_tokens: 1024,
      system: systemPrompt,
      messages: [{ role: 'user', content: userMessage }]
    })
  });
  if (!res.ok) { const e = await res.text(); throw new Error('API error: ' + e); }
  const data = await res.json();
  return data.content[0].text;
}

// ===== Self Introduction Page =====
(function() {
  const page = document.getElementById('page-intro');
  let savedIntros = storageGet('intros', []);
  let introMode = 'template';

  function render() {
    let html = `
      <div class="page-header"><span class="page-header-icon">ğŸ§</span><h1 class="page-header-title">è‡ªå·±ç´¹ä»‹</h1></div>
      <div class="pal-welcome" style="margin-bottom:20px"><div style="font-size:1.5rem">ğŸ§</div><div class="pal-message">æ—…å…ˆã§ã®è‡ªå·±ç´¹ä»‹ã‚’è‹±èªã§æº–å‚™ã—ã‚ˆã†ï¼<strong>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ‰</strong>ã§ç°¡å˜ã«ä½œã‚Œã‚‹ã—ã€<strong>AIç¿»è¨³ãƒ¢ãƒ¼ãƒ‰</strong>ã§è‡ªç”±ã«æ›¸ã„ã¦ã‚‚OKï¼</div></div>
      <div class="api-key-section">
        <strong>ğŸ”‘ API Keyï¼ˆAIç¿»è¨³ã«å¿…è¦ï¼‰</strong><br>
        <input type="password" class="input" placeholder="sk-ant-..." value="${claudeApiKey}" onchange="window._setApiKey(this.value)" style="margin-top:8px">
      </div>
      <div class="mode-tabs">
        <button class="mode-tab ${introMode==='template'?'active':''}" onclick="window._introMode('template')">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</button>
        <button class="mode-tab ${introMode==='ai'?'active':''}" onclick="window._introMode('ai')">AIç¿»è¨³</button>
      </div>
    `;

    if (introMode === 'template') {
      html += `
        <div style="background:var(--white);border-radius:var(--radius-lg);padding:20px;box-shadow:var(--shadow-md);margin-bottom:20px">
          <div style="margin-bottom:12px"><label style="font-size:0.85rem;color:var(--text-light)">åå‰</label><input class="input" id="intro-name" placeholder="Taro"></div>
          <div style="margin-bottom:12px"><label style="font-size:0.85rem;color:var(--text-light)">å‡ºèº«åœ°</label><input class="input" id="intro-from" placeholder="Tokyo, Japan"></div>
          <div style="margin-bottom:12px"><label style="font-size:0.85rem;color:var(--text-light)">è·æ¥­</label><input class="input" id="intro-job" placeholder="software engineer"></div>
          <div style="margin-bottom:12px"><label style="font-size:0.85rem;color:var(--text-light)">è¶£å‘³</label><input class="input" id="intro-hobby" placeholder="traveling, photography"></div>
          <div style="margin-bottom:12px"><label style="font-size:0.85rem;color:var(--text-light)">æ—…è¡Œã®ç›®çš„</label>
            <select class="input" id="intro-purpose">
              <option value="holiday">è¦³å…‰ãƒ»ä¼‘æš‡</option>
              <option value="business">ãƒ“ã‚¸ãƒã‚¹</option>
              <option value="study">ç•™å­¦ãƒ»èªå­¦</option>
              <option value="backpacking">ãƒãƒƒã‚¯ãƒ‘ãƒƒã‚­ãƒ³ã‚°</option>
            </select>
          </div>
          <button class="btn btn-primary" onclick="window._generateTemplate()" style="width:100%">è‹±èªã®è‡ªå·±ç´¹ä»‹ã‚’ç”Ÿæˆ âœ¨</button>
          <div id="intro-template-result" style="margin-top:16px"></div>
        </div>
      `;
    } else {
      html += `
        <div style="background:var(--white);border-radius:var(--radius-lg);padding:20px;box-shadow:var(--shadow-md);margin-bottom:20px">
          <label style="font-size:0.85rem;color:var(--text-light)">æ—¥æœ¬èªã§è‡ªç”±ã«è‡ªå·±ç´¹ä»‹ã‚’æ›¸ã„ã¦ã­</label>
          <textarea class="textarea" id="intro-freetext" placeholder="ä¾‹ï¼šã“ã‚“ã«ã¡ã¯ï¼å¤ªéƒã§ã™ã€‚æ±äº¬ã‹ã‚‰æ¥ã¾ã—ãŸã€‚å†™çœŸã‚’æ’®ã‚‹ã®ãŒå¥½ãã§ã€ä»Šå›ã¯ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ã®å»ºç¯‰ã‚’è¦‹ã«æ¥ã¾ã—ãŸï¼" style="margin-top:8px"></textarea>
          <button class="btn btn-accent" onclick="window._translateIntro()" style="width:100%;margin-top:12px">AIã§è‹±èªã«ç¿»è¨³ ğŸ§</button>
          <div id="intro-ai-result" style="margin-top:16px"></div>
        </div>
      `;
    }

    // Saved introductions
    html += `<h3 style="font-family:var(--font-display);font-size:1.1rem;color:var(--main);margin:24px 0 12px">ğŸ“ ä¿å­˜ã—ãŸè‡ªå·±ç´¹ä»‹</h3>`;
    if (savedIntros.length === 0) {
      html += `<div class="empty-state"><span class="empty-state-icon">ğŸ“</span><div class="empty-state-text">ã¾ã ä¿å­˜ã•ã‚ŒãŸè‡ªå·±ç´¹ä»‹ã¯ã‚ã‚Šã¾ã›ã‚“</div></div>`;
    } else {
      savedIntros.forEach((intro, i) => {
        html += `<div class="saved-card"><div class="phrase-en" style="font-size:1rem">${intro.en}</div>${intro.jp ? `<div class="phrase-jp" style="margin-top:8px">${intro.jp}</div>` : ''}<div class="saved-card-actions"><button onclick="window._deleteIntro(${i})">å‰Šé™¤</button></div></div>`;
      });
    }
    page.innerHTML = html;
  }

  window._setApiKey = function(key) { claudeApiKey = key; storageSet('apiKey', key); };
  window._introMode = function(mode) { introMode = mode; render(); };

  window._generateTemplate = function() {
    const name = document.getElementById('intro-name').value || 'someone';
    const from = document.getElementById('intro-from').value || 'Japan';
    const job = document.getElementById('intro-job').value;
    const hobby = document.getElementById('intro-hobby').value;
    const purpose = document.getElementById('intro-purpose').value;
    const purposeMap = { holiday:'on holiday', business:'on a business trip', study:'here to study', backpacking:'backpacking' };
    let text = `Hi, I'm ${name}! I'm from ${from}.`;
    if (job) text += ` I work as a ${job}.`;
    if (hobby) text += ` I'm into ${hobby}.`;
    text += ` I'm ${purposeMap[purpose] || 'on holiday'}.`;
    text += ` Nice to meet you!`;

    const resultDiv = document.getElementById('intro-template-result');
    resultDiv.innerHTML = `<div class="phrase-card" style="border-left-color:var(--accent)"><div class="phrase-en">${text}</div><button class="btn btn-ghost" style="margin-top:10px" onclick="window._saveIntro('','${text.replace(/'/g,"\\'")}')">ğŸ’¾ ä¿å­˜</button></div>`;
  };

  window._translateIntro = async function() {
    const jp = document.getElementById('intro-freetext').value.trim();
    if (!jp) return;
    const resultDiv = document.getElementById('intro-ai-result');
    resultDiv.innerHTML = `<div class="loading-pal"><div class="pal-bounce">ğŸ§</div><div class="loading-text">ãƒ‘ãƒ«ãŒç¿»è¨³ä¸­...</div></div>`;
    try {
      const en = await callClaude('ã‚ãªãŸã¯è‹±ä¼šè©±ã®ç¿»è¨³ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚æ—¥æœ¬èªã®è‡ªå·±ç´¹ä»‹æ–‡ã‚’ã€æµ·å¤–æ—…è¡Œä¸­ã®æ—¥å¸¸ä¼šè©±ã§è‡ªç„¶ã«ä½¿ãˆã‚‹è‹±èªã«ç¿»è¨³ã—ã¦ãã ã•ã„ã€‚å …ã™ããšã€ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ã§è‡ªç„¶ãªå£èªè¡¨ç¾ã«ã—ã¦ãã ã•ã„ã€‚', jp);
      resultDiv.innerHTML = `<div class="phrase-card" style="border-left-color:var(--accent)"><div class="phrase-en">${en}</div><button class="btn btn-ghost" style="margin-top:10px" onclick="window._saveIntro('${jp.replace(/'/g,"\\'")}','${en.replace(/'/g,"\\'")}')">ğŸ’¾ ä¿å­˜</button></div>`;
    } catch(e) {
      resultDiv.innerHTML = `<div class="error-msg">ğŸ§ ãƒ‘ãƒ«ãŒè¿·å­ã«ãªã£ã¡ã‚ƒã£ãŸâ€¦ã‚‚ã†ä¸€åº¦è©¦ã—ã¦ã­<br><small>${e.message}</small></div>`;
    }
  };

  window._saveIntro = function(jp, en) {
    savedIntros.push({ jp, en, date: new Date().toISOString() });
    storageSet('intros', savedIntros);
    render();
  };

  window._deleteIntro = function(idx) {
    savedIntros.splice(idx, 1);
    storageSet('intros', savedIntros);
    render();
  };

  render();
})();

// ===== Custom Phrase Page =====
(function() {
  const page = document.getElementById('page-custom');
  let customPhrases = storageGet('customPhrases', []);
  let searchText = '';

  function render() {
    let html = `
      <div class="page-header"><span class="page-header-icon">âœï¸</span><h1 class="page-header-title">ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒ¬ãƒ¼ã‚º</h1></div>
      <div class="pal-welcome" style="margin-bottom:20px"><div style="font-size:1.5rem">ğŸ§</div><div class="pal-message">ã€Œã“ã‚Œè‹±èªã§ä½•ã¦è¨€ã†ã®ï¼Ÿã€ã‚’ãƒ‘ãƒ«ã«èã„ã¦ã¿ã‚ˆã†ï¼<br>AIãŒ<strong>ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ç‰ˆ</strong>ã¨<strong>ãƒãƒ©ã‚¤ãƒˆç‰ˆ</strong>ã‚’æ•™ãˆã¦ãã‚Œã‚‹ã‚ˆã€‚</div></div>
      <div class="api-key-section">
        <strong>ğŸ”‘ API Key</strong>
        <input type="password" class="input" placeholder="sk-ant-..." value="${claudeApiKey}" onchange="window._setApiKey(this.value)">
      </div>
      <div style="background:var(--white);border-radius:var(--radius-lg);padding:20px;box-shadow:var(--shadow-md);margin-bottom:20px">
        <label style="font-size:0.85rem;color:var(--text-light)">æ—¥æœ¬èªã§å…¥åŠ›ã—ã¦ã­</label>
        <textarea class="textarea" id="custom-input" placeholder="ä¾‹ï¼šã“ã®å¸­ã¯ç©ºã„ã¦ã„ã¾ã™ã‹ï¼Ÿ" style="margin-top:8px;min-height:60px"></textarea>
        <button class="btn btn-accent" onclick="window._translateCustom()" style="width:100%;margin-top:12px">è‹±èªã«ç¿»è¨³ ğŸ§</button>
        <div id="custom-result" style="margin-top:16px"></div>
      </div>
      <h3 style="font-family:var(--font-display);font-size:1.1rem;color:var(--main);margin:24px 0 12px">ğŸ“– ãƒ•ãƒ¬ãƒ¼ã‚ºå¸³ (${customPhrases.length})</h3>
      <div class="search-box"><input class="input" placeholder="ãƒ•ãƒ¬ãƒ¼ã‚ºã‚’æ¤œç´¢..." value="${searchText}" oninput="window._customSearch(this.value)"></div>
    `;

    const filtered = customPhrases.filter(p => {
      if (!searchText) return true;
      const q = searchText.toLowerCase();
      return p.jp.toLowerCase().includes(q) || p.en.toLowerCase().includes(q);
    });

    if (filtered.length === 0) {
      html += `<div class="empty-state"><span class="empty-state-icon">âœï¸</span><div class="empty-state-text">${searchText ? 'è©²å½“ã™ã‚‹ãƒ•ãƒ¬ãƒ¼ã‚ºãŒã‚ã‚Šã¾ã›ã‚“' : 'ç¿»è¨³ã—ãŸãƒ•ãƒ¬ãƒ¼ã‚ºãŒã“ã“ã«ä¿å­˜ã•ã‚Œã¾ã™'}</div></div>`;
    } else {
      filtered.forEach((p, i) => {
        const favClass = isFavorite('c_'+i) ? 'active' : '';
        const favIcon = isFavorite('c_'+i) ? 'â˜…' : 'â˜†';
        html += `<div class="phrase-card"><button class="fav-btn ${favClass}" data-phrase-id="c_${i}" onclick="toggleFavorite('c_${i}');window._customRender();event.stopPropagation();">${favIcon}</button><div class="phrase-jp">${p.jp}</div><div class="phrase-en">${p.en}</div><div class="saved-card-actions"><button class="delete-btn" onclick="window._deleteCustom(${i})">å‰Šé™¤</button></div></div>`;
      });
    }

    page.innerHTML = html;
  }

  window._customSearch = function(q) { searchText = q; render(); };
  window._customRender = render;

  window._translateCustom = async function() {
    const jp = document.getElementById('custom-input').value.trim();
    if (!jp) return;
    const resultDiv = document.getElementById('custom-result');
    resultDiv.innerHTML = `<div class="loading-pal"><div class="pal-bounce">ğŸ§</div><div class="loading-text">ãƒ‘ãƒ«ãŒç¿»è¨³ä¸­...</div></div>`;
    try {
      const en = await callClaude('ã‚ãªãŸã¯è‹±ä¼šè©±ã®ç¿»è¨³ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚æ—¥æœ¬èªã‚’ã€ãƒã‚¤ãƒ†ã‚£ãƒ–ãŒæ—¥å¸¸ä¼šè©±ã§è‡ªç„¶ã«ä½¿ã†è‹±èªè¡¨ç¾ã«ç¿»è¨³ã—ã¦ãã ã•ã„ã€‚ç›´è¨³ã§ã¯ãªãã€å®Ÿéš›ã«å£èªã§ä½¿ã‚ã‚Œã‚‹è‡ªç„¶ãªè¡¨ç¾ã«ã—ã¦ãã ã•ã„ã€‚ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ç‰ˆã¨ãƒãƒ©ã‚¤ãƒˆç‰ˆã®ä¸¡æ–¹ã‚’æç¤ºã—ã¦ãã ã•ã„ã€‚', jp);
      resultDiv.innerHTML = `<div class="phrase-card" style="border-left-color:var(--accent)"><div class="phrase-jp">${jp}</div><div class="phrase-en" style="white-space:pre-wrap">${en}</div><button class="btn btn-ghost" style="margin-top:10px" onclick="window._saveCustom('${jp.replace(/'/g,"\\'")}', this)">ğŸ’¾ ä¿å­˜</button></div>`;
    } catch(e) {
      resultDiv.innerHTML = `<div class="error-msg">ğŸ§ ãƒ‘ãƒ«ãŒè¿·å­ã«ãªã£ã¡ã‚ƒã£ãŸâ€¦ã‚‚ã†ä¸€åº¦è©¦ã—ã¦ã­<br><small>${e.message}</small></div>`;
    }
  };

  window._saveCustom = function(jp, btn) {
    const card = btn.closest('.phrase-card');
    const en = card.querySelector('.phrase-en').textContent;
    customPhrases.unshift({ jp, en, date: new Date().toISOString() });
    storageSet('customPhrases', customPhrases);
    render();
  };

  window._deleteCustom = function(idx) {
    customPhrases.splice(idx, 1);
    storageSet('customPhrases', customPhrases);
    render();
  };

  render();
})();

// ===== Init =====
updateProgressSummary();
</script>

</body>
</html>
