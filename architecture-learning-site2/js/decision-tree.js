/* ========================================
   ã‚¢ãƒ¼ã‚­é¸å®šãƒ‡ã‚£ã‚·ã‚¸ãƒ§ãƒ³ãƒ„ãƒªãƒ¼
   ======================================== */

const DecisionTree = (() => {
  // ãƒ„ãƒªãƒ¼ãƒãƒ¼ãƒ‰å®šç¾©
  const nodes = {
    start: {
      type: 'question',
      text: 'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†ãŒå¿…è¦ã§ã™ã‹ï¼Ÿ',
      description: 'ä¾‹ï¼šãƒãƒ£ãƒƒãƒˆã€IoTã‚»ãƒ³ã‚µãƒ¼ç›£è¦–ã€æ ªä¾¡è¡¨ç¤ºã€ãƒ©ã‚¤ãƒ–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãªã©',
      options: [
        { label: 'ã¯ã„ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§ãŒé‡è¦', next: 'realtime-users' },
        { label: 'ã„ã„ãˆã€ãƒãƒƒãƒå‡¦ç†ã‚„ãƒªã‚¯ã‚¨ã‚¹ãƒˆå¿œç­”ã§ååˆ†', next: 'batch-users' }
      ]
    },

    // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç³»ãƒ–ãƒ©ãƒ³ãƒ
    'realtime-users': {
      type: 'question',
      text: 'åŒæ™‚æ¥ç¶šãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã¯ã©ã®ãã‚‰ã„ã§ã™ã‹ï¼Ÿ',
      description: 'ãƒ”ãƒ¼ã‚¯æ™‚ã®åŒæ™‚ã‚¢ã‚¯ã‚»ã‚¹æ•°ã®è¦‹è¾¼ã¿ã‚’é¸ã‚“ã§ãã ã•ã„',
      options: [
        { label: 'ã€œ100äººç¨‹åº¦ï¼ˆç¤¾å†…ã‚·ã‚¹ãƒ†ãƒ ç­‰ï¼‰', next: 'realtime-small' },
        { label: 'ã€œ10,000äººï¼ˆä¸­è¦æ¨¡ã‚µãƒ¼ãƒ“ã‚¹ï¼‰', next: 'realtime-medium' },
        { label: '10,000äººä»¥ä¸Šï¼ˆå¤§è¦æ¨¡ã‚µãƒ¼ãƒ“ã‚¹ï¼‰', next: 'realtime-large' }
      ]
    },
    'realtime-small': {
      type: 'question',
      text: 'æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æºã¯å¯†ã§ã™ã‹ï¼Ÿ',
      description: 'æ—¢å­˜ã®ã‚ªãƒ³ãƒ—ãƒ¬ã‚·ã‚¹ãƒ†ãƒ ã‚„ãƒ¬ã‚¬ã‚·ãƒ¼DBã¨ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«ãƒ‡ãƒ¼ã‚¿ã‚’ã‚„ã‚Šå–ã‚Šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ',
      options: [
        { label: 'ã¯ã„ã€æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã¨ã®å¯†çµåˆãŒå¿…è¦', next: 'result-monolith-realtime' },
        { label: 'ã„ã„ãˆã€æ–°è¦æ§‹ç¯‰ã¾ãŸã¯APIé€£æºã§ååˆ†', next: 'result-three-tier-ws' }
      ]
    },
    'realtime-medium': {
      type: 'question',
      text: 'ãƒ‡ãƒ¼ã‚¿ã®ä¸€è²«æ€§ã¯ã©ã®ç¨‹åº¦é‡è¦ã§ã™ã‹ï¼Ÿ',
      description: 'ä¾‹ï¼šé‡‘èå–å¼•ã®ã‚ˆã†ãªå³å¯†ãªä¸€è²«æ€§ vs SNSã®ã€Œã„ã„ã­ã€ã®ã‚ˆã†ãªç·©ã„ä¸€è²«æ€§',
      options: [
        { label: 'å³å¯†ãªä¸€è²«æ€§ãŒå¿…é ˆï¼ˆé‡‘èãƒ»åœ¨åº«ç­‰ï¼‰', next: 'result-three-tier-strict' },
        { label: 'çµæœæ•´åˆæ€§ã§ååˆ†ï¼ˆSNSãƒ»é€šçŸ¥ç­‰ï¼‰', next: 'result-event-driven' }
      ]
    },
    'realtime-large': {
      type: 'question',
      text: 'ã‚¹ã‚±ãƒ¼ãƒ«ã®æ–¹å‘æ€§ã¯ï¼Ÿ',
      description: 'è² è·ã«å¯¾ã—ã¦ã©ã®ã‚ˆã†ã«ã‚¹ã‚±ãƒ¼ãƒ«ã•ã›ãŸã„ã§ã™ã‹ï¼Ÿ',
      options: [
        { label: 'æ©Ÿèƒ½å˜ä½ã§ç‹¬ç«‹ã—ã¦ã‚¹ã‚±ãƒ¼ãƒ«ã—ãŸã„', next: 'result-microservices-event' },
        { label: 'å…¨ä½“ã‚’å‡ç­‰ã«ã‚¹ã‚±ãƒ¼ãƒ«ã§ãã‚Œã°ã‚ˆã„', next: 'result-event-driven-large' }
      ]
    },

    // ãƒãƒƒãƒãƒ»ãƒªã‚¯ã‚¨ã‚¹ãƒˆå¿œç­”ç³»ãƒ–ãƒ©ãƒ³ãƒ
    'batch-users': {
      type: 'question',
      text: 'åŒæ™‚æ¥ç¶šãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã¯ã©ã®ãã‚‰ã„ã§ã™ã‹ï¼Ÿ',
      description: 'ãƒ”ãƒ¼ã‚¯æ™‚ã®åŒæ™‚ã‚¢ã‚¯ã‚»ã‚¹æ•°ã®è¦‹è¾¼ã¿ã‚’é¸ã‚“ã§ãã ã•ã„',
      options: [
        { label: 'ã€œ100äººç¨‹åº¦ï¼ˆç¤¾å†…ã‚·ã‚¹ãƒ†ãƒ ç­‰ï¼‰', next: 'batch-small' },
        { label: 'ã€œ10,000äººï¼ˆä¸­è¦æ¨¡ã‚µãƒ¼ãƒ“ã‚¹ï¼‰', next: 'batch-medium' },
        { label: '10,000äººä»¥ä¸Šï¼ˆå¤§è¦æ¨¡ã‚µãƒ¼ãƒ“ã‚¹ï¼‰', next: 'batch-large' }
      ]
    },
    'batch-small': {
      type: 'question',
      text: 'æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æºã¯å¯†ã§ã™ã‹ï¼Ÿ',
      description: 'æ—¢å­˜ã®ã‚ªãƒ³ãƒ—ãƒ¬ã‚·ã‚¹ãƒ†ãƒ ã‚„ãƒ¬ã‚¬ã‚·ãƒ¼DBã¨å¯†ã«ãƒ‡ãƒ¼ã‚¿ã‚’ã‚„ã‚Šå–ã‚Šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ',
      options: [
        { label: 'ã¯ã„ã€æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã¨å¯†çµåˆ', next: 'result-monolith' },
        { label: 'ã„ã„ãˆã€ç‹¬ç«‹ã—ãŸã‚·ã‚¹ãƒ†ãƒ ', next: 'result-three-tier' }
      ]
    },
    'batch-medium': {
      type: 'question',
      text: 'ãƒ‡ãƒ¼ã‚¿ã®ä¸€è²«æ€§ã¯ã©ã®ç¨‹åº¦é‡è¦ã§ã™ã‹ï¼Ÿ',
      description: 'å³å¯†ãªãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†ãŒå¿…è¦ã‹ã€çµæœæ•´åˆæ€§ã§ååˆ†ã‹ã‚’é¸ã‚“ã§ãã ã•ã„',
      options: [
        { label: 'å³å¯†ãªä¸€è²«æ€§ãŒå¿…é ˆ', next: 'result-three-tier-strict-batch' },
        { label: 'çµæœæ•´åˆæ€§ã§ååˆ†', next: 'batch-medium-scale' }
      ]
    },
    'batch-medium-scale': {
      type: 'question',
      text: 'ã‚¹ã‚±ãƒ¼ãƒ«ã®æ–¹å‘æ€§ã¯ï¼Ÿ',
      description: 'ä»Šå¾Œã®æˆé•·ã«å¯¾ã—ã¦ã©ã†ã‚¹ã‚±ãƒ¼ãƒ«ã•ã›ãŸã„ã§ã™ã‹ï¼Ÿ',
      options: [
        { label: 'æ©Ÿèƒ½å˜ä½ã§ç‹¬ç«‹ã—ã¦ã‚¹ã‚±ãƒ¼ãƒ«ã—ãŸã„', next: 'result-microservices' },
        { label: 'å¿…è¦ãªã¨ãã ã‘å‹•ã‘ã°ã‚ˆã„ï¼ˆã‚³ã‚¹ãƒˆé‡è¦–ï¼‰', next: 'result-serverless' }
      ]
    },
    'batch-large': {
      type: 'question',
      text: 'ã‚¹ã‚±ãƒ¼ãƒ«ã®æ–¹å‘æ€§ã¯ï¼Ÿ',
      description: 'å¤§è¦æ¨¡ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ã«ã©ã†å¯¾å¿œã—ã¾ã™ã‹ï¼Ÿ',
      options: [
        { label: 'æ©Ÿèƒ½å˜ä½ã§ç‹¬ç«‹ã—ã¦ã‚¹ã‚±ãƒ¼ãƒ«ã—ãŸã„', next: 'result-microservices-large' },
        { label: 'ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã§éåŒæœŸã«å‡¦ç†ã—ãŸã„', next: 'result-event-driven-batch' }
      ]
    },

    // ===== çµæœãƒãƒ¼ãƒ‰ =====
    'result-monolith-realtime': {
      type: 'result',
      pattern: 'ãƒ¢ãƒãƒªã‚¹ï¼‹WebSocketæ‹¡å¼µ',
      icon: 'ğŸ ',
      summary: 'æ—¢å­˜ãƒ¢ãƒãƒªã‚¹ã«WebSocketæ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹æ§‹æˆ',
      reason: 'æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã¨ã®å¯†çµåˆãŒå¿…è¦ã§ã€ã‹ã¤å°è¦æ¨¡ãªãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¦ä»¶ã®å ´åˆã€ãƒ¢ãƒãƒªã‚¹æ§‹æˆã«WebSocketæ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹ã®ãŒæœ€ã‚‚ã‚³ã‚¹ãƒˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒè‰¯ã„ã§ã™ã€‚å¤§è¦æ¨¡ãªå†æ§‹ç¯‰ã‚’é¿ã‘ãªãŒã‚‰ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ©Ÿèƒ½ã‚’å®Ÿç¾ã§ãã¾ã™ã€‚',
      strengths: ['æ—¢å­˜è³‡ç”£ã‚’æ´»ã‹ã›ã‚‹', 'é–‹ç™ºãƒ»é‹ç”¨ã‚³ã‚¹ãƒˆãŒä½ã„', 'ãƒãƒ¼ãƒ å­¦ç¿’ã‚³ã‚¹ãƒˆãŒå°‘ãªã„'],
      weaknesses: ['ã‚¹ã‚±ãƒ¼ãƒ«ã«é™ç•ŒãŒã‚ã‚‹', 'æ©Ÿèƒ½è¿½åŠ ãŒè¤‡é›‘åŒ–ã—ã‚„ã™ã„', 'å°†æ¥ã®å¤§è¦æ¨¡åŒ–ã«ã¯å¯¾å¿œå›°é›£'],
      useCases: ['ç¤¾å†…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰', 'å°è¦æ¨¡ãƒãƒ£ãƒƒãƒˆ', 'åœ¨åº«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º']
    },
    'result-three-tier-ws': {
      type: 'result',
      pattern: '3å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼‹WebSocket',
      icon: 'ğŸ¢',
      summary: 'æ¨™æº–çš„ãª3å±¤æ§‹æˆã«ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡ã‚’è¿½åŠ ',
      reason: 'å°è¦æ¨¡ã‹ã¤æ–°è¦æ§‹ç¯‰ã®å ´åˆã€3å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãŒæœ€ã‚‚ãƒãƒ©ãƒ³ã‚¹ãŒå–ã‚Œã¦ã„ã¾ã™ã€‚WebSocketã‚µãƒ¼ãƒãƒ¼ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ©Ÿèƒ½ã‚‚å®Ÿç¾ã§ãã¾ã™ã€‚',
      strengths: ['æ§‹æˆãŒã‚·ãƒ³ãƒ—ãƒ«ã§ç†è§£ã—ã‚„ã™ã„', 'å®Ÿç¸¾è±Šå¯Œã§æŠ€è¡“è€…ãŒå¤šã„', 'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ©Ÿèƒ½ã‚’æŸ”è»Ÿã«è¿½åŠ å¯èƒ½'],
      weaknesses: ['å¤§è¦æ¨¡ã«ãªã‚‹ã¨æ€§èƒ½èª²é¡ŒãŒå‡ºã‚‹', 'WebSocketéƒ¨åˆ†ã®é‹ç”¨ãƒã‚¦ãƒã‚¦ãŒå¿…è¦'],
      useCases: ['éƒ¨é–€å†…ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¥­å‹™ã‚¢ãƒ—ãƒª', 'IoTç›£è¦–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆå°è¦æ¨¡ï¼‰']
    },
    'result-three-tier-strict': {
      type: 'result',
      pattern: '3å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¼·åŒ–ï¼‰',
      icon: 'ğŸ¦',
      summary: 'RDBMSã®å¼·ã„ä¸€è²«æ€§ã‚’æ´»ã‹ã—ãŸæ§‹æˆ',
      reason: 'ä¸­è¦æ¨¡ã§ãƒ‡ãƒ¼ã‚¿ä¸€è²«æ€§ãŒæœ€é‡è¦ãªå ´åˆã€RDBMSã®ACIDãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’å…¨é¢çš„ã«æ´»ç”¨ã™ã‚‹3å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãŒæœ€é©ã§ã™ã€‚ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨CDNã§è£œå¼·ã—ã¾ã™ã€‚',
      strengths: ['å¼·ã„ãƒ‡ãƒ¼ã‚¿ä¸€è²«æ€§', 'ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç†ãŒå®¹æ˜“', 'é‡‘èãƒ»åœ¨åº«ç®¡ç†ã¨ã®ç›¸æ€§ãŒè‰¯ã„'],
      weaknesses: ['æ°´å¹³ã‚¹ã‚±ãƒ¼ãƒ«ã«é™ç•Œ', 'DB ãŒãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã«ãªã‚Šã‚„ã™ã„'],
      useCases: ['é‡‘èå–å¼•ã‚·ã‚¹ãƒ†ãƒ ', 'åœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ', 'äºˆç´„ã‚·ã‚¹ãƒ†ãƒ ']
    },
    'result-event-driven': {
      type: 'result',
      pattern: 'ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£',
      icon: 'âš¡',
      summary: 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚­ãƒ¥ãƒ¼ã‚’ä¸­å¿ƒã¨ã—ãŸãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†',
      reason: 'ä¸­è¦æ¨¡ã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§ãŒå¿…è¦ã€ã‹ã¤çµæœæ•´åˆæ€§ã§ååˆ†ãªå ´åˆã€ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãŒåŠ¹æœçš„ã§ã™ã€‚ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚­ãƒ¥ãƒ¼ï¼ˆKafkaã€SQSç­‰ï¼‰ã‚’ä½¿ã„ã€éåŒæœŸã«ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‡¦ç†ã—ã¾ã™ã€‚',
      strengths: ['é«˜ã„ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£', 'ç–çµåˆã§å¤‰æ›´ã«å¼·ã„', 'éšœå®³ã®å½±éŸ¿ãŒå±€æ‰€åŒ–'],
      weaknesses: ['è¨­è¨ˆã®è¤‡é›‘ã•', 'ãƒ‡ãƒãƒƒã‚°ãŒé›£ã—ã„', 'ãƒãƒ¼ãƒ ã«çµŒé¨“è€…ãŒå¿…è¦'],
      useCases: ['ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šçŸ¥', 'SNSãƒ•ã‚£ãƒ¼ãƒ‰', 'ãƒ­ã‚°åé›†ãƒ»åˆ†æ']
    },
    'result-microservices-event': {
      type: 'result',
      pattern: 'ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ï¼‹ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•',
      icon: 'ğŸŒ',
      summary: 'æ©Ÿèƒ½å˜ä½ã®ç‹¬ç«‹ã‚µãƒ¼ãƒ“ã‚¹ç¾¤ã‚’ã‚¤ãƒ™ãƒ³ãƒˆã§é€£æº',
      reason: 'å¤§è¦æ¨¡ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‹ã¤æ©Ÿèƒ½ç‹¬ç«‹ã‚¹ã‚±ãƒ¼ãƒ«ãŒå¿…è¦ãªå ´åˆã®ç‹é“ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚å„ã‚µãƒ¼ãƒ“ã‚¹ãŒç‹¬ç«‹ã—ã¦ã‚¹ã‚±ãƒ¼ãƒ«ã—ã€ã‚¤ãƒ™ãƒ³ãƒˆãƒã‚¹çµŒç”±ã§é€£æºã—ã¾ã™ã€‚',
      strengths: ['æ©Ÿèƒ½ã”ã¨ã«ç‹¬ç«‹ã—ã¦ã‚¹ã‚±ãƒ¼ãƒ«å¯èƒ½', 'æŠ€è¡“é¸æŠã®è‡ªç”±åº¦ãŒé«˜ã„', 'ãƒãƒ¼ãƒ ã®ç‹¬ç«‹æ€§ãŒé«˜ã„'],
      weaknesses: ['é‹ç”¨ã®è¤‡é›‘ã•ãŒæœ€å¤§', 'åˆ†æ•£ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®é›£ã—ã•', 'é«˜ã„æŠ€è¡“åŠ›ãŒå¿…è¦'],
      useCases: ['å¤§è¦æ¨¡ECã‚µã‚¤ãƒˆ', 'ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹', 'å¤§è¦æ¨¡IoTãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ']
    },
    'result-event-driven-large': {
      type: 'result',
      pattern: 'ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ï¼ˆå¤§è¦æ¨¡ï¼‰',
      icon: 'ğŸŒŠ',
      summary: 'Kafkaãªã©ã®ã‚¹ãƒˆãƒªãƒ¼ãƒ å‡¦ç†ã‚’ä¸­å¿ƒã¨ã—ãŸæ§‹æˆ',
      reason: 'å¤§è¦æ¨¡ã§å‡ç­‰ã‚¹ã‚±ãƒ¼ãƒ«ã§ã‚ˆã„å ´åˆã€ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°åŸºç›¤ã‚’ä¸­å¿ƒã«æ®ãˆã‚‹ã“ã¨ã§ã€å¤§é‡ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’åŠ¹ç‡çš„ã«å‡¦ç†ã§ãã¾ã™ã€‚',
      strengths: ['å¤§é‡ãƒ‡ãƒ¼ã‚¿ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†', 'ã‚¤ãƒ™ãƒ³ãƒˆå†å‡¦ç†ãŒå¯èƒ½', 'ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆãŒå®¹æ˜“'],
      weaknesses: ['Kafkaç­‰ã®é‹ç”¨ãŒè¤‡é›‘', 'ã‚³ã‚¹ãƒˆãŒé«˜ããªã‚ŠãŒã¡', 'è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç¿’ç†ŸãŒå¿…è¦'],
      useCases: ['å¤§è¦æ¨¡ãƒ­ã‚°åˆ†æ', 'ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‰', 'ä¸æ­£æ¤œçŸ¥ã‚·ã‚¹ãƒ†ãƒ ']
    },
    'result-monolith': {
      type: 'result',
      pattern: 'ãƒ¢ãƒãƒªã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£',
      icon: 'ğŸ ',
      summary: '1ã¤ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã™ã¹ã¦ã®æ©Ÿèƒ½ã‚’é›†ç´„',
      reason: 'å°è¦æ¨¡ã§æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã¨ã®å¯†çµåˆãŒå¿…è¦ãªå ´åˆã€ãƒ¢ãƒãƒªã‚¹ãŒæœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ã‹ã¤ç¢ºå®Ÿã§ã™ã€‚é–‹ç™ºãƒ»é‹ç”¨ã‚³ã‚¹ãƒˆãŒæœ€å°ã§ã€1ãƒãƒ¼ãƒ ã§ç®¡ç†ã—ã‚„ã™ã„æ§‹æˆã§ã™ã€‚',
      strengths: ['é–‹ç™ºãŒã‚·ãƒ³ãƒ—ãƒ«', 'é‹ç”¨ã‚³ã‚¹ãƒˆãŒä½ã„', 'ãƒ‡ãƒãƒƒã‚°ãŒå®¹æ˜“'],
      weaknesses: ['æ©Ÿèƒ½è¿½åŠ ãŒè¤‡é›‘åŒ–ã—ã‚„ã™ã„', 'ã‚¹ã‚±ãƒ¼ãƒ«ã«é™ç•Œ', 'éƒ¨åˆ†çš„ãªãƒ‡ãƒ—ãƒ­ã‚¤ãŒå›°é›£'],
      useCases: ['ç¤¾å†…æ¥­å‹™ã‚·ã‚¹ãƒ†ãƒ ', 'ãƒ¬ã‚¬ã‚·ãƒ¼é€£æºãŒå¤šã„ã‚·ã‚¹ãƒ†ãƒ ', 'å°è¦æ¨¡Webã‚¢ãƒ—ãƒª']
    },
    'result-three-tier': {
      type: 'result',
      pattern: '3å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£',
      icon: 'ğŸ¢',
      summary: 'ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãƒ»ãƒ‡ãƒ¼ã‚¿ã®3å±¤åˆ†é›¢',
      reason: 'å°è¦æ¨¡ã§æ–°è¦æ§‹ç¯‰ã®å ´åˆã€3å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãŒæœ€ã‚‚å®‰å®šã—ãŸé¸æŠã§ã™ã€‚ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒè±Šå¯Œã§ã€å¤šãã®é–‹ç™ºè€…ãŒæ…£ã‚Œè¦ªã—ã‚“ã§ã„ã¾ã™ã€‚',
      strengths: ['æœ€ã‚‚å®Ÿç¸¾è±Šå¯Œãªæ§‹æˆ', 'æŠ€è¡“è€…ãŒå¤šã„', 'è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ãŒç¢ºç«‹'],
      weaknesses: ['å¤§è¦æ¨¡ã«ã¯å‘ã‹ãªã„', 'å±¤é–“ã®ä¾å­˜ãŒç”Ÿã¾ã‚Œã‚„ã™ã„'],
      useCases: ['Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨èˆ¬', 'ç®¡ç†ç”»é¢', 'ãƒ‡ãƒ¼ã‚¿å…¥åŠ›ç³»ã‚·ã‚¹ãƒ†ãƒ ']
    },
    'result-three-tier-strict-batch': {
      type: 'result',
      pattern: '3å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¼·åŒ–ï¼‰',
      icon: 'ğŸ¦',
      summary: 'RDBMSã®ACIDãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ´»ç”¨ã—ãŸå …ç‰¢ãªæ§‹æˆ',
      reason: 'ä¸­è¦æ¨¡ã§ãƒ‡ãƒ¼ã‚¿ä¸€è²«æ€§ãŒæœ€é‡è¦ã®å ´åˆã€å¾“æ¥å‹ã®3å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«RDBMSã®å¼·åŠ›ãªãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã®ãŒæœ€ã‚‚ç¢ºå®Ÿã§ã™ã€‚',
      strengths: ['å¼·ã„ãƒ‡ãƒ¼ã‚¿ä¸€è²«æ€§', 'æ¯ã‚ŒãŸæŠ€è¡“ã§å®‰å®šç¨¼åƒ', 'ç›£æŸ»å¯¾å¿œãŒå®¹æ˜“'],
      weaknesses: ['ã‚¹ã‚±ãƒ¼ãƒ«ã«ä¸Šé™ãŒã‚ã‚‹', 'DBãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚³ã‚¹ãƒˆãŒé«˜ã„å ´åˆã‚‚'],
      useCases: ['ä¼šè¨ˆã‚·ã‚¹ãƒ†ãƒ ', 'å—ç™ºæ³¨ç®¡ç†', 'å¥‘ç´„ç®¡ç†']
    },
    'result-microservices': {
      type: 'result',
      pattern: 'ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£',
      icon: 'ğŸ”§',
      summary: 'æ©Ÿèƒ½ã”ã¨ã«ç‹¬ç«‹ã—ãŸã‚µãƒ¼ãƒ“ã‚¹ã‚’APIé€£æº',
      reason: 'ä¸­è¦æ¨¡ã§æ©Ÿèƒ½ç‹¬ç«‹ã‚¹ã‚±ãƒ¼ãƒ«ãŒå¿…è¦ãªå ´åˆã€ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ãŒæœ‰åŠ¹ã§ã™ã€‚å„ãƒãƒ¼ãƒ ãŒç‹¬ç«‹ã—ã¦ã‚µãƒ¼ãƒ“ã‚¹ã‚’é–‹ç™ºãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚‹ãŸã‚ã€é–‹ç™ºé€Ÿåº¦ãŒå‘ä¸Šã—ã¾ã™ã€‚',
      strengths: ['æ©Ÿèƒ½ã”ã¨ã®ç‹¬ç«‹ã‚¹ã‚±ãƒ¼ãƒ«', 'ãƒãƒ¼ãƒ ç‹¬ç«‹æ€§', 'æŠ€è¡“é¸æŠã®è‡ªç”±'],
      weaknesses: ['åˆ†æ•£ã‚·ã‚¹ãƒ†ãƒ ã®è¤‡é›‘ã•', 'ã‚µãƒ¼ãƒ“ã‚¹é–“é€šä¿¡ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰', 'é‹ç”¨ãƒ„ãƒ¼ãƒ«ãŒå¿…è¦'],
      useCases: ['ä¸­è¦æ¨¡ECã‚µã‚¤ãƒˆ', 'SaaSãƒ—ãƒ­ãƒ€ã‚¯ãƒˆ', 'ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ']
    },
    'result-serverless': {
      type: 'result',
      pattern: 'ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£',
      icon: 'â˜ï¸',
      summary: 'å¿…è¦ãªæ™‚ã ã‘å‹•ãå¾“é‡èª²é‡‘å‹ã®æ§‹æˆ',
      reason: 'ä¸­è¦æ¨¡ã§ã‚³ã‚¹ãƒˆé‡è¦–ã€ã‹ã¤çµæœæ•´åˆæ€§ã§ååˆ†ãªå ´åˆã€ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ãŒæœ€ã‚‚è²»ç”¨å¯¾åŠ¹æœãŒé«˜ã„ã§ã™ã€‚ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ãŒå°‘ãªã„æ™‚ã¯è²»ç”¨ãŒã»ã¼ã‚¼ãƒ­ã§ã€æ€¥ãªã‚¹ãƒ‘ã‚¤ã‚¯ã«ã‚‚è‡ªå‹•å¯¾å¿œã—ã¾ã™ã€‚',
      strengths: ['å¾“é‡èª²é‡‘ã§ã‚³ã‚¹ãƒˆæœ€é©', 'é‹ç”¨è² è·ãŒæ¥µã‚ã¦ä½ã„', 'è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒ«'],
      weaknesses: ['ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆã®é…å»¶', 'ãƒ™ãƒ³ãƒ€ãƒ¼ãƒ­ãƒƒã‚¯ã‚¤ãƒ³', 'é•·æ™‚é–“å‡¦ç†ã«ä¸å‘ã'],
      useCases: ['APIãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰', 'ãƒãƒƒãƒå‡¦ç†', 'Webãƒ•ãƒƒã‚¯å—ä¿¡']
    },
    'result-microservices-large': {
      type: 'result',
      pattern: 'ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆå¤§è¦æ¨¡ï¼‰',
      icon: 'ğŸŒ',
      summary: 'ã‚³ãƒ³ãƒ†ãƒŠã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹å¤§è¦æ¨¡ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹',
      reason: 'å¤§è¦æ¨¡ã§æ©Ÿèƒ½ç‹¬ç«‹ã‚¹ã‚±ãƒ¼ãƒ«ãŒå¿…è¦ãªå ´åˆã®æ¨™æº–çš„ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚Kubernetesãªã©ã®ã‚³ãƒ³ãƒ†ãƒŠã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã€æ•°ç™¾ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’åŠ¹ç‡çš„ã«é‹ç”¨ã—ã¾ã™ã€‚',
      strengths: ['æœ€å¤§ã®ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£', 'éšœå®³ã®å½±éŸ¿ã‚’å±€æ‰€åŒ–', 'ç‹¬ç«‹ã—ãŸé–‹ç™ºã‚µã‚¤ã‚¯ãƒ«'],
      weaknesses: ['é‹ç”¨ã®è¤‡é›‘ã•ãŒæœ€å¤§', 'K8sç­‰ã®å°‚é–€çŸ¥è­˜ãŒå¿…é ˆ', 'ã‚³ã‚¹ãƒˆãŒé«˜ã„'],
      useCases: ['å¤§è¦æ¨¡Webã‚µãƒ¼ãƒ“ã‚¹', 'ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãƒ“ã‚¸ãƒã‚¹', 'ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚µãƒ¼ãƒ“ã‚¹']
    },
    'result-event-driven-batch': {
      type: 'result',
      pattern: 'ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ï¼‹ãƒãƒƒãƒå‡¦ç†',
      icon: 'âš¡',
      summary: 'ã‚¤ãƒ™ãƒ³ãƒˆã‚­ãƒ¥ãƒ¼ã¨ãƒãƒƒãƒå‡¦ç†ã‚’çµ„ã¿åˆã‚ã›ãŸæ§‹æˆ',
      reason: 'å¤§è¦æ¨¡ã§ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã‚’é¸ã¶å ´åˆã€éåŒæœŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°ã§ãƒ”ãƒ¼ã‚¯è² è·ã‚’å¹³æº–åŒ–ã—ã€ãƒãƒƒãƒå‡¦ç†ã§å¤§é‡ãƒ‡ãƒ¼ã‚¿ã‚’åŠ¹ç‡çš„ã«å‡¦ç†ã—ã¾ã™ã€‚',
      strengths: ['ãƒ”ãƒ¼ã‚¯è² è·ã®å¹³æº–åŒ–', 'å¤§é‡ãƒ‡ãƒ¼ã‚¿ã®åŠ¹ç‡å‡¦ç†', 'ç–çµåˆã§å¤‰æ›´ã«å¼·ã„'],
      weaknesses: ['ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§ã¯é™å®šçš„', 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é †åºã®ä¿è¨¼ãŒè¤‡é›‘', 'ç›£è¦–ãŒé›£ã—ã„'],
      useCases: ['å¤§é‡æ³¨æ–‡å‡¦ç†', 'ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³', 'ETLå‡¦ç†åŸºç›¤']
    }
  };

  let currentNodeId = 'start';
  let history = [];
  let containerEl = null;

  function init(containerId) {
    containerEl = document.getElementById(containerId);
    if (!containerEl) return;
    render();
  }

  function render() {
    const node = nodes[currentNodeId];
    if (!node) return;

    if (node.type === 'question') {
      renderQuestion(node);
    } else {
      renderResult(node);
    }
  }

  function renderQuestion(node) {
    const stepNum = history.length + 1;
    const historyHTML = history.map((h, i) => `
      <div class="dt-history-item">
        <span class="dt-history-step">Q${i + 1}</span>
        <span class="dt-history-q">${h.question}</span>
        <span class="dt-history-a">â†’ ${h.answer}</span>
      </div>
    `).join('');

    containerEl.innerHTML = `
      ${history.length > 0 ? `<div class="dt-history">${historyHTML}</div>` : ''}
      <div class="dt-question-card">
        <div class="dt-step-badge">è³ªå• ${stepNum}</div>
        <h3 class="dt-question-text">${node.text}</h3>
        <p class="dt-question-desc">${node.description}</p>
        <div class="dt-options">
          ${node.options.map((opt, i) => `
            <button class="dt-option-btn" data-index="${i}">
              <span class="dt-option-icon">â–¶</span>
              ${opt.label}
            </button>
          `).join('')}
        </div>
      </div>
      ${history.length > 0 ? '<button class="dt-back-btn">â† 1ã¤å‰ã«æˆ»ã‚‹</button>' : ''}
    `;

    // Bind events
    containerEl.querySelectorAll('.dt-option-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const idx = parseInt(btn.dataset.index);
        const opt = node.options[idx];
        history.push({
          nodeId: currentNodeId,
          question: node.text,
          answer: opt.label
        });
        currentNodeId = opt.next;
        render();
        containerEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
      });
    });

    const backBtn = containerEl.querySelector('.dt-back-btn');
    if (backBtn) {
      backBtn.addEventListener('click', goBack);
    }
  }

  function renderResult(node) {
    const historyHTML = history.map((h, i) => `
      <div class="dt-history-item">
        <span class="dt-history-step">Q${i + 1}</span>
        <span class="dt-history-q">${h.question}</span>
        <span class="dt-history-a">â†’ ${h.answer}</span>
      </div>
    `).join('');

    containerEl.innerHTML = `
      <div class="dt-history">${historyHTML}</div>
      <div class="dt-result-card">
        <div class="dt-result-header">
          <span class="dt-result-icon">${node.icon}</span>
          <div>
            <div class="dt-result-label">æ¨å¥¨ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£</div>
            <h3 class="dt-result-pattern">${node.pattern}</h3>
          </div>
        </div>
        <p class="dt-result-summary">${node.summary}</p>
        <div class="dt-result-reason">
          <h4>ğŸ“‹ é¸å®šç†ç”±</h4>
          <p>${node.reason}</p>
        </div>
        <div class="dt-result-columns">
          <div class="dt-result-strengths">
            <h4>âœ… å¼·ã¿</h4>
            <ul>${node.strengths.map(s => `<li>${s}</li>`).join('')}</ul>
          </div>
          <div class="dt-result-weaknesses">
            <h4>âš ï¸ æ³¨æ„ç‚¹</h4>
            <ul>${node.weaknesses.map(w => `<li>${w}</li>`).join('')}</ul>
          </div>
        </div>
        <div class="dt-result-usecases">
          <h4>ğŸ’¼ ä»£è¡¨çš„ãªãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹</h4>
          <div class="dt-usecase-tags">
            ${node.useCases.map(u => `<span class="dt-usecase-tag">${u}</span>`).join('')}
          </div>
        </div>
      </div>
      <div class="dt-actions">
        <button class="dt-back-btn">â† 1ã¤å‰ã«æˆ»ã‚‹</button>
        <button class="dt-reset-btn">ğŸ”„ ã‚‚ã†ä¸€åº¦ã‚„ã‚Šç›´ã™</button>
      </div>
    `;

    const backBtn = containerEl.querySelector('.dt-back-btn');
    if (backBtn) backBtn.addEventListener('click', goBack);

    const resetBtn = containerEl.querySelector('.dt-reset-btn');
    if (resetBtn) resetBtn.addEventListener('click', reset);
  }

  function goBack() {
    if (history.length === 0) return;
    const prev = history.pop();
    currentNodeId = prev.nodeId;
    render();
  }

  function reset() {
    currentNodeId = 'start';
    history = [];
    render();
    containerEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }

  return { init };
})();
